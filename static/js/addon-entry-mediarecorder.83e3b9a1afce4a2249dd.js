(window.webpackJsonpGUI=window.webpackJsonpGUI||[]).push([[42],{1508:function(e,t,n){"use strict";t.a=(e,t)=>{const n=document.createElement("a");if(document.body.appendChild(n),navigator.msSaveOrOpenBlob)navigator.msSaveOrOpenBlob(t,e);else if("download"in HTMLAnchorElement.prototype){const o=window.URL.createObjectURL(t);n.href=o,n.download=e,n.type=t.type,n.click(),window.setTimeout(()=>{document.body.removeChild(n),window.URL.revokeObjectURL(o)},1e3)}else{let e=window.open("","_blank");const n=new FileReader;n.onloadend=function(){e.location.href=n.result,e=null},n.readAsDataURL(t)}}},1572:function(e,t,n){(e.exports=n(9)(!1)).push([e.i,'.mediaRecorderPopup {\n  box-sizing: border-box;\n  width: 700px;\n  max-height: min(800px, 80vh);\n  max-width: 85%;\n  margin-top: 12vh;\n  overflow-y: auto;\n  margin-left: auto;\n  margin-right: auto;\n}\n\n.mediaRecorderPopupContent {\n  padding: 1.5rem 2.25rem;\n}\n\n.mediaRecorderPopup p {\n  font-size: 1rem;\n  margin: 0.5rem auto;\n}\n\n.mediaRecorderPopup p :last-child {\n  margin-left: 1rem;\n}\n\n.mediaRecorderPopup[dir="rtl"] p :last-child {\n  margin-left: 0;\n  margin-right: 1rem;\n}\n\np.mediaRecorderPopupOption {\n  display: flex;\n  align-items: center;\n}\n\n.mediaRecorderPopupOption input[type="checkbox"] {\n  height: 1.5rem;\n}\n\n#recordOptionSecondsInput,\n#recordOptionDelayInput {\n  width: 6rem;\n}\n\n.mediaRecorderPopupButtons {\n  margin-top: 1.5rem;\n}\n\n.mediaRecorderPopupButtons button {\n  margin-left: 0.5rem;\n}\n\n.mediaRecorderPopupButtons button:nth-of-type(1) {\n  color: black;\n}\n',""])},1669:function(e,t,n){"use strict";n.r(t),n.d(t,"resources",(function(){return r}));var o=n(1508),a=n(1572);const r={"userscript.js":async e=>{let t,n,a,{addon:r,console:c,msg:i}=e,d=!1,l=!1,s=null,p=null,m=null,u=[];const b=["video/webm; codecs=vp9","video/webm","video/mp4"].find(e=>MediaRecorder.isTypeSupported(e)),h=b.split(";")[0].split("/")[1];for(;;){const e=await r.tab.waitForElement('div[class*="menu-bar_file-group"] > div:last-child:not(.sa-record)',{markAsSeen:!0,reduxEvents:["scratch-gui/mode/SET_PLAYER","fontsLoaded/SET_FONTS_LOADED","scratch-gui/locales/SELECT_LOCALE"]}),g=()=>{const{backdrop:e,container:t,content:n,closeButton:o,remove:a}=r.tab.createModal(i("option-title"),{isOpen:!0,useEditorClasses:!0});t.classList.add("mediaRecorderPopup"),n.classList.add("mediaRecorderPopupContent"),n.appendChild(Object.assign(document.createElement("p"),{textContent:i("record-description",{extension:".".concat(h)}),className:"recordOptionDescription"}));const c=document.createElement("p"),d=Object.assign(document.createElement("input"),{type:"number",min:1,max:600,defaultValue:30,id:"recordOptionSecondsInput",className:r.tab.scratchClass("prompt_variable-name-text-input")}),l=Object.assign(document.createElement("label"),{htmlFor:"recordOptionSecondsInput",textContent:i("record-duration")});c.appendChild(l),c.appendChild(d),n.appendChild(c);const s=document.createElement("p"),p=Object.assign(document.createElement("input"),{type:"number",min:0,max:600,defaultValue:0,id:"recordOptionDelayInput",className:r.tab.scratchClass("prompt_variable-name-text-input")}),m=Object.assign(document.createElement("label"),{htmlFor:"recordOptionDelayInput",textContent:i("start-delay")});s.appendChild(m),s.appendChild(p),n.appendChild(s);const u=Object.assign(document.createElement("p"),{className:"mediaRecorderPopupOption"}),b=Object.assign(document.createElement("input"),{type:"checkbox",defaultChecked:!0,id:"recordOptionAudioInput"}),g=Object.assign(document.createElement("label"),{htmlFor:"recordOptionAudioInput",textContent:i("record-audio"),title:i("record-audio-description")});u.appendChild(b),u.appendChild(g),n.appendChild(u);const O=Object.assign(document.createElement("p"),{className:"mediaRecorderPopupOption"}),C=Object.assign(document.createElement("input"),{type:"checkbox",defaultChecked:!1,id:"recordOptionMicInput"}),E=Object.assign(document.createElement("label"),{htmlFor:"recordOptionMicInput",textContent:i("record-mic")});O.appendChild(C),O.appendChild(E),n.appendChild(O);const f=Object.assign(document.createElement("p"),{className:"mediaRecorderPopupOption"}),v=Object.assign(document.createElement("input"),{type:"checkbox",defaultChecked:!0,id:"recordOptionFlagInput"}),w=Object.assign(document.createElement("label"),{htmlFor:"recordOptionFlagInput",textContent:i("record-after-flag")});f.appendChild(v),f.appendChild(w),n.appendChild(f);const x=Object.assign(document.createElement("p"),{className:"mediaRecorderPopupOption"}),k=Object.assign(document.createElement("input"),{type:"checkbox",defaultChecked:!0,id:"recordOptionStopInput"}),R=Object.assign(document.createElement("label"),{htmlFor:"recordOptionStopInput",textContent:i("record-until-stop")});v.addEventListener("change",()=>{(k.disabled=!v.checked)&&(R.title=i("record-until-stop-disabled",{afterFlagOption:i("record-after-flag")}))}),x.appendChild(k),x.appendChild(R),n.appendChild(x);let y=null;const P=new Promise(e=>{y=e});let S=null;e.addEventListener("click",()=>S(null)),o.addEventListener("click",()=>S(null)),S=e=>{y(e),a()};const j=Object.assign(document.createElement("div"),{className:r.tab.scratchClass("prompt_button-row",{others:"mediaRecorderPopupButtons"})}),T=Object.assign(document.createElement("button"),{textContent:i("cancel")});T.addEventListener("click",()=>S(null),{once:!0}),j.appendChild(T);const L=Object.assign(document.createElement("button"),{textContent:i("start"),className:r.tab.scratchClass("prompt_ok-button")});return L.addEventListener("click",()=>S({secs:Number(d.value),delay:Number(p.value),audioEnabled:b.checked,micEnabled:C.checked,waitUntilFlag:v.checked,useStopSign:!k.disabled&&k.checked}),{once:!0}),j.appendChild(L),n.appendChild(j),P},O=()=>{d=!1,t.textContent=i("record"),t.title="",n=null,u=[],clearTimeout(a),a=0,m&&(r.tab.traps.vm.runtime.off("PROJECT_STOP_ALL",m),m=null)},C=e=>{if(l)return r.tab.traps.vm.runtime.off("PROJECT_START",s),l=!1,s=null,p.abort(),p=null,void O();d&&n&&"inactive"!==n.state&&(e?O():(n.onstop=()=>{var e,t,n;const a=new Blob(u,{type:b});Object(o.a)("".concat((null===(e=r.tab.redux.state)||void 0===e||null===(t=e.preview)||void 0===t||null===(n=t.projectInfo)||void 0===n?void 0:n.title)||"video",".").concat(h),a),O()},n.stop()))},E=async e=>{const o=Math.min(600,Math.max(1,e.secs));u=[],d=!0;const h=r.tab.traps.vm;let g;if(e.micEnabled)try{g=await navigator.mediaDevices.getUserMedia({audio:!0})}catch(t){if("NotAllowedError"!==t.name&&"NotFoundError"!==t.name)throw t;e.micEnabled=!1}if(e.waitUntilFlag){l=!0,Object.assign(t,{textContent:i("click-flag"),title:i("click-flag-description")}),p=new AbortController;try{await Promise.race([new Promise(e=>{s=()=>e(),h.runtime.once("PROJECT_START",s)}),new Promise((e,t)=>{p.signal.addEventListener("abort",()=>t("aborted"),{once:!0})})])}catch(e){if("aborted"===e.message)return;throw e}}l=!1,s=p=null;const O=new MediaStream,E=h.runtime.renderer.canvas.captureStream();O.addTrack(E.getVideoTracks()[0]);const f=new AudioContext,v=f.createMediaStreamDestination();if(e.audioEnabled){const e=h.runtime.audioEngine.audioContext.createMediaStreamDestination();h.runtime.audioEngine.inputNode.connect(e);f.createMediaStreamSource(e.stream).connect(v)}if(e.micEnabled){f.createMediaStreamSource(g).connect(v)}(e.audioEnabled||e.micEnabled)&&O.addTrack(v.stream.getAudioTracks()[0]),n=new MediaRecorder(O,{mimeType:b}),n.ondataavailable=e=>{u.push(e.data)},n.onerror=e=>{c.warn("Recorder error:",e.error),C(!0)},a=setTimeout(()=>C(!1),1e3*o),e.useStopSign&&(m=()=>C(),h.runtime.once("PROJECT_STOP_ALL",m));const w=e.delay||0,x=Math.floor(w);for(let e=0;e<x;e++)t.textContent=i("starting-in",{secs:x-e}),await new Promise(e=>setTimeout(e,975));setTimeout(()=>{t.textContent=i("stop"),n.start(1e3)},1e3*(w-x))};t||(t=Object.assign(document.createElement("div"),{className:"sa-record "+e.className,textContent:i("record")}),t.addEventListener("click",async()=>{if(d)C();else{const e=await g();if(!e)return void c.log("Canceled");E(e)}})),e.parentElement.appendChild(t)}},"style.css":n.n(a).a}}}]);