(window.webpackJsonpGUI=window.webpackJsonpGUI||[]).push([[34],{1499:function(e,t,n){"use strict";t.a=(e,t)=>{const n=document.createElement("a");if(document.body.appendChild(n),navigator.msSaveOrOpenBlob)navigator.msSaveOrOpenBlob(t,e);else if("download"in HTMLAnchorElement.prototype){const a=window.URL.createObjectURL(t);n.href=a,n.download=e,n.type=t.type,n.click(),window.setTimeout(()=>{document.body.removeChild(n),window.URL.revokeObjectURL(a)},1e3)}else{let e=window.open("","_blank");const n=new FileReader;n.onloadend=function(){e.location.href=n.result,e=null},n.readAsDataURL(t)}}},1556:function(e,t,n){(e.exports=n(9)(!1)).push([e.i,'.mediaRecorderPopup {\n  box-sizing: border-box;\n  width: 700px;\n  max-height: min(800px, 80vh);\n  max-width: 85%;\n  margin-top: 12vh;\n  overflow-y: auto;\n  margin-left: auto;\n  margin-right: auto;\n}\n\n.mediaRecorderPopupContent {\n  padding: 1.5rem 2.25rem;\n}\n\n.mediaRecorderPopup p {\n  font-size: 1rem;\n  margin: 0.5rem auto;\n}\n\n.mediaRecorderPopup p :last-child {\n  margin-left: 1rem;\n}\n\n.mediaRecorderPopup[dir="rtl"] p :last-child {\n  margin-left: 0;\n  margin-right: 1rem;\n}\n\np.mediaRecorderPopupOption {\n  display: flex;\n  align-items: center;\n}\n\n.mediaRecorderPopupOption input[type="checkbox"] {\n  height: 1.5rem;\n}\n\n#recordOptionSecondsInput,\n#recordOptionDelayInput {\n  width: 6rem;\n}\n\n.mediaRecorderPopupButtons {\n  margin-top: 1.5rem;\n}\n\n.mediaRecorderPopupButtons button {\n  margin-left: 0.5rem;\n}\n\n/* TW: Fixes cancel button in dark mode */\n.mediaRecorderPopupButtons button:nth-of-type(1) {\n  color: black;\n}\n',""])},1620:function(e,t,n){"use strict";n.r(t),n.d(t,"resources",(function(){return r}));var a=n(1499),o=n(1556);const r={"userscript.js":async e=>{let t,n,o,{addon:r,console:c,msg:i}=e,d=!1,l=!1,s=null,p=null,m=null,u=[];for(;;){const e=await r.tab.waitForElement('div[class*="menu-bar_file-group"] > div:last-child:not(.sa-record)',{markAsSeen:!0,reduxEvents:["scratch-gui/mode/SET_PLAYER","fontsLoaded/SET_FONTS_LOADED","scratch-gui/locales/SELECT_LOCALE"]}),b=()=>{const{backdrop:e,container:t,content:n,closeButton:a,remove:o}=r.tab.createModal(i("option-title"),{isOpen:!0,useEditorClasses:!0});t.classList.add("mediaRecorderPopup"),n.classList.add("mediaRecorderPopupContent"),n.appendChild(Object.assign(document.createElement("p"),{textContent:i("record-description"),className:"recordOptionDescription"}));const c=document.createElement("p"),d=Object.assign(document.createElement("input"),{type:"number",min:1,max:300,defaultValue:30,id:"recordOptionSecondsInput",className:r.tab.scratchClass("prompt_variable-name-text-input")}),l=Object.assign(document.createElement("label"),{htmlFor:"recordOptionSecondsInput",textContent:i("record-duration")});c.appendChild(l),c.appendChild(d),n.appendChild(c);const s=document.createElement("p"),p=Object.assign(document.createElement("input"),{type:"number",min:0,max:300,defaultValue:0,id:"recordOptionDelayInput",className:r.tab.scratchClass("prompt_variable-name-text-input")}),m=Object.assign(document.createElement("label"),{htmlFor:"recordOptionDelayInput",textContent:i("start-delay")});s.appendChild(m),s.appendChild(p),n.appendChild(s);const u=Object.assign(document.createElement("p"),{className:"mediaRecorderPopupOption"}),b=Object.assign(document.createElement("input"),{type:"checkbox",defaultChecked:!0,id:"recordOptionAudioInput"}),h=Object.assign(document.createElement("label"),{htmlFor:"recordOptionAudioInput",textContent:i("record-audio"),title:i("record-audio-description")});u.appendChild(b),u.appendChild(h),n.appendChild(u);const g=Object.assign(document.createElement("p"),{className:"mediaRecorderPopupOption"}),O=Object.assign(document.createElement("input"),{type:"checkbox",defaultChecked:!1,id:"recordOptionMicInput"}),C=Object.assign(document.createElement("label"),{htmlFor:"recordOptionMicInput",textContent:i("record-mic")});g.appendChild(O),g.appendChild(C),n.appendChild(g);const E=Object.assign(document.createElement("p"),{className:"mediaRecorderPopupOption"}),f=Object.assign(document.createElement("input"),{type:"checkbox",defaultChecked:!0,id:"recordOptionFlagInput"}),w=Object.assign(document.createElement("label"),{htmlFor:"recordOptionFlagInput",textContent:i("record-after-flag")});E.appendChild(f),E.appendChild(w),n.appendChild(E);const v=Object.assign(document.createElement("p"),{className:"mediaRecorderPopupOption"}),x=Object.assign(document.createElement("input"),{type:"checkbox",defaultChecked:!0,id:"recordOptionStopInput"}),k=Object.assign(document.createElement("label"),{htmlFor:"recordOptionStopInput",textContent:i("record-until-stop")});f.addEventListener("change",()=>{(x.disabled=!f.checked)&&(k.title=i("record-until-stop-disabled",{afterFlagOption:i("record-after-flag")}))}),v.appendChild(x),v.appendChild(k),n.appendChild(v);let R=null;const y=new Promise(e=>{R=e});let P=null;e.addEventListener("click",()=>P(null)),a.addEventListener("click",()=>P(null)),P=e=>{R(e),o()};const S=Object.assign(document.createElement("div"),{className:r.tab.scratchClass("prompt_button-row",{others:"mediaRecorderPopupButtons"})}),j=Object.assign(document.createElement("button"),{textContent:i("cancel")});j.addEventListener("click",()=>P(null),{once:!0}),S.appendChild(j);const T=Object.assign(document.createElement("button"),{textContent:i("start"),className:r.tab.scratchClass("prompt_ok-button")});return T.addEventListener("click",()=>P({secs:Number(d.value),delay:Number(p.value),audioEnabled:b.checked,micEnabled:O.checked,waitUntilFlag:f.checked,useStopSign:!x.disabled&&x.checked}),{once:!0}),S.appendChild(T),n.appendChild(S),y},h=()=>{d=!1,t.textContent=i("record"),t.title="",n=null,u=[],clearTimeout(o),o=0,m&&(r.tab.traps.vm.runtime.off("PROJECT_STOP_ALL",m),m=null)},g=e=>{if(l)return r.tab.traps.vm.runtime.off("PROJECT_START",s),l=!1,s=null,p.abort(),p=null,void h();d&&n&&"inactive"!==n.state&&(e?h():(n.onstop=()=>{const e=new Blob(u,{type:"video/webm"});Object(a.a)("video.webm",e),h()},n.stop()))},O=async e=>{const a=Math.min(300,Math.max(1,e.secs));u=[],d=!0;const b=r.tab.traps.vm;let h;if(e.micEnabled)try{h=await navigator.mediaDevices.getUserMedia({audio:!0})}catch(t){if("NotAllowedError"!==t.name&&"NotFoundError"!==t.name)throw t;e.micEnabled=!1}if(e.waitUntilFlag){l=!0,Object.assign(t,{textContent:i("click-flag"),title:i("click-flag-description")}),p=new AbortController;try{await Promise.race([new Promise(e=>{s=()=>e(),b.runtime.once("PROJECT_START",s)}),new Promise((e,t)=>{p.signal.addEventListener("abort",()=>t("aborted"),{once:!0})})])}catch(e){if("aborted"===e.message)return;throw e}}l=!1,s=p=null;const O=new MediaStream,C=b.runtime.renderer.canvas.captureStream();O.addTrack(C.getVideoTracks()[0]);const E=new AudioContext,f=E.createMediaStreamDestination();if(e.audioEnabled){const e=b.runtime.audioEngine.audioContext.createMediaStreamDestination();b.runtime.audioEngine.inputNode.connect(e);E.createMediaStreamSource(e.stream).connect(f)}if(e.micEnabled){E.createMediaStreamSource(h).connect(f)}(e.audioEnabled||e.micEnabled)&&O.addTrack(f.stream.getAudioTracks()[0]),n=new MediaRecorder(O,{mimeType:"video/webm"}),n.ondataavailable=e=>{u.push(e.data)},n.onerror=e=>{c.warn("Recorder error:",e.error),g(!0)},o=setTimeout(()=>g(!1),1e3*a),e.useStopSign&&(m=()=>g(),b.runtime.once("PROJECT_STOP_ALL",m));const w=e.delay||0,v=Math.floor(w);for(let e=0;e<v;e++)t.textContent=i("starting-in",{secs:v-e}),await new Promise(e=>setTimeout(e,975));setTimeout(()=>{t.textContent=i("stop"),n.start(1e3)},1e3*(w-v))};t||(t=Object.assign(document.createElement("div"),{className:"sa-record "+e.className,textContent:i("record")}),t.addEventListener("click",async()=>{if(d)g();else{const e=await b();if(!e)return void c.log("Canceled");O(e)}})),e.parentElement.appendChild(t)}},"style.css":n.n(o).a}}}]);