(window.webpackJsonpGUI=window.webpackJsonpGUI||[]).push([[4],{1497:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));class o{constructor(e,t){this.targetId=e.id,this.id=t.id}}},1501:function(e,t,n){"use strict";n.d(t,"a",(function(){return o})),n.d(t,"b",(function(){return s}));const o=()=>/^#?[0-9a-fA-F]{3,8}$/,s=e=>{let t=String(e);if(!o().test(t))return"#000000";if(t.startsWith("#")||(t="#".concat(t)),4===t.length){const[e,n,o,s]=t;t="#".concat(n).concat(n).concat(o).concat(o).concat(s).concat(s)}return t.toLowerCase()}},1502:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));class o{constructor(e){this.timeout=null,this.callback=null,this.wait=e}abort(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.timeout&&(clearTimeout(this.timeout),e&&this.callback(),this.timeout=this.callback=null)}limit(e){this.abort(!1),this.callback=e,this.timeout=setTimeout(()=>{this.timeout=this.callback=null,e()},this.wait)}}},1503:function(e,t,n){"use strict";const o=function(e){var t=/^\s+/,n=/\s+$/,o=0,s=e.round,r=e.min,i=e.max,a=e.random;function l(a,c){if(c=c||{},(a=a||"")instanceof l)return a;if(!(this instanceof l))return new l(a,c);var d=function(o){var s={r:0,g:0,b:0},a=1,l=null,c=null,d=null,u=!1,p=!1;"string"==typeof o&&(o=function(e){e=e.replace(t,"").replace(n,"").toLowerCase();var o,s=!1;if(C[e])e=C[e],s=!0;else if("transparent"==e)return{r:0,g:0,b:0,a:0,format:"name"};if(o=H.rgb.exec(e))return{r:o[1],g:o[2],b:o[3]};if(o=H.rgba.exec(e))return{r:o[1],g:o[2],b:o[3],a:o[4]};if(o=H.hsl.exec(e))return{h:o[1],s:o[2],l:o[3]};if(o=H.hsla.exec(e))return{h:o[1],s:o[2],l:o[3],a:o[4]};if(o=H.hsv.exec(e))return{h:o[1],s:o[2],v:o[3]};if(o=H.hsva.exec(e))return{h:o[1],s:o[2],v:o[3],a:o[4]};if(o=H.hex8.exec(e))return{r:S(o[1]),g:S(o[2]),b:S(o[3]),a:j(o[4]),format:s?"name":"hex8"};if(o=H.hex6.exec(e))return{r:S(o[1]),g:S(o[2]),b:S(o[3]),format:s?"name":"hex"};if(o=H.hex4.exec(e))return{r:S(o[1]+""+o[1]),g:S(o[2]+""+o[2]),b:S(o[3]+""+o[3]),a:j(o[4]+""+o[4]),format:s?"name":"hex8"};if(o=H.hex3.exec(e))return{r:S(o[1]+""+o[1]),g:S(o[2]+""+o[2]),b:S(o[3]+""+o[3]),format:s?"name":"hex"};return!1}(o));"object"==typeof o&&(Z(o.r)&&Z(o.g)&&Z(o.b)?(h=o.r,g=o.g,m=o.b,s={r:255*N(h,255),g:255*N(g,255),b:255*N(m,255)},u=!0,p="%"===String(o.r).substr(-1)?"prgb":"rgb"):Z(o.h)&&Z(o.s)&&Z(o.v)?(l=A(o.s),c=A(o.v),s=function(t,n,o){t=6*N(t,360),n=N(n,100),o=N(o,100);var s=e.floor(t),r=t-s,i=o*(1-n),a=o*(1-r*n),l=o*(1-(1-r)*n),c=s%6;return{r:255*[o,a,i,i,l,o][c],g:255*[l,o,o,a,i,i][c],b:255*[i,i,l,o,o,a][c]}}(o.h,l,c),u=!0,p="hsv"):Z(o.h)&&Z(o.s)&&Z(o.l)&&(l=A(o.s),d=A(o.l),s=function(e,t,n){var o,s,r;function i(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+(t-e)*(2/3-n)*6:e}if(e=N(e,360),t=N(t,100),n=N(n,100),0===t)o=s=r=n;else{var a=n<.5?n*(1+t):n+t-n*t,l=2*n-a;o=i(l,a,e+1/3),s=i(l,a,e),r=i(l,a,e-1/3)}return{r:255*o,g:255*s,b:255*r}}(o.h,l,d),u=!0,p="hsl"),o.hasOwnProperty("a")&&(a=o.a));var h,g,m;return a=L(a),{ok:u,format:o.format||p,r:r(255,i(s.r,0)),g:r(255,i(s.g,0)),b:r(255,i(s.b,0)),a:a}}(a);this._originalInput=a,this._r=d.r,this._g=d.g,this._b=d.b,this._a=d.a,this._roundA=s(100*this._a)/100,this._format=c.format||d.format,this._gradientType=c.gradientType,this._r<1&&(this._r=s(this._r)),this._g<1&&(this._g=s(this._g)),this._b<1&&(this._b=s(this._b)),this._ok=d.ok,this._tc_id=o++}function c(e,t,n){e=N(e,255),t=N(t,255),n=N(n,255);var o,s,a=i(e,t,n),l=r(e,t,n),c=(a+l)/2;if(a==l)o=s=0;else{var d=a-l;switch(s=c>.5?d/(2-a-l):d/(a+l),a){case e:o=(t-n)/d+(t<n?6:0);break;case t:o=(n-e)/d+2;break;case n:o=(e-t)/d+4}o/=6}return{h:o,s:s,l:c}}function d(e,t,n){e=N(e,255),t=N(t,255),n=N(n,255);var o,s,a=i(e,t,n),l=r(e,t,n),c=a,d=a-l;if(s=0===a?0:d/a,a==l)o=0;else{switch(a){case e:o=(t-n)/d+(t<n?6:0);break;case t:o=(n-e)/d+2;break;case n:o=(e-t)/d+4}o/=6}return{h:o,s:s,v:c}}function u(e,t,n,o){var r=[E(s(e).toString(16)),E(s(t).toString(16)),E(s(n).toString(16))];return o&&r[0].charAt(0)==r[0].charAt(1)&&r[1].charAt(0)==r[1].charAt(1)&&r[2].charAt(0)==r[2].charAt(1)?r[0].charAt(0)+r[1].charAt(0)+r[2].charAt(0):r.join("")}function p(e,t,n,o){return[E(B(o)),E(s(e).toString(16)),E(s(t).toString(16)),E(s(n).toString(16))].join("")}function h(e,t){t=0===t?0:t||10;var n=l(e).toHsl();return n.s-=t/100,n.s=M(n.s),l(n)}function g(e,t){t=0===t?0:t||10;var n=l(e).toHsl();return n.s+=t/100,n.s=M(n.s),l(n)}function m(e){return l(e).desaturate(100)}function f(e,t){t=0===t?0:t||10;var n=l(e).toHsl();return n.l+=t/100,n.l=M(n.l),l(n)}function b(e,t){t=0===t?0:t||10;var n=l(e).toRgb();return n.r=i(0,r(255,n.r-s(-t/100*255))),n.g=i(0,r(255,n.g-s(-t/100*255))),n.b=i(0,r(255,n.b-s(-t/100*255))),l(n)}function v(e,t){t=0===t?0:t||10;var n=l(e).toHsl();return n.l-=t/100,n.l=M(n.l),l(n)}function y(e,t){var n=l(e).toHsl(),o=(n.h+t)%360;return n.h=o<0?360+o:o,l(n)}function k(e){var t=l(e).toHsl();return t.h=(t.h+180)%360,l(t)}function x(e){var t=l(e).toHsl(),n=t.h;return[l(e),l({h:(n+120)%360,s:t.s,l:t.l}),l({h:(n+240)%360,s:t.s,l:t.l})]}function w(e){var t=l(e).toHsl(),n=t.h;return[l(e),l({h:(n+90)%360,s:t.s,l:t.l}),l({h:(n+180)%360,s:t.s,l:t.l}),l({h:(n+270)%360,s:t.s,l:t.l})]}function I(e){var t=l(e).toHsl(),n=t.h;return[l(e),l({h:(n+72)%360,s:t.s,l:t.l}),l({h:(n+216)%360,s:t.s,l:t.l})]}function _(e,t,n){t=t||6,n=n||30;var o=l(e).toHsl(),s=360/n,r=[l(e)];for(o.h=(o.h-(s*t>>1)+720)%360;--t;)o.h=(o.h+s)%360,r.push(l(o));return r}function D(e,t){t=t||6;for(var n=l(e).toHsv(),o=n.h,s=n.s,r=n.v,i=[],a=1/t;t--;)i.push(l({h:o,s:s,v:r})),r=(r+a)%1;return i}l.prototype={isDark:function(){return this.getBrightness()<128},isLight:function(){return!this.isDark()},isValid:function(){return this._ok},getOriginalInput:function(){return this._originalInput},getFormat:function(){return this._format},getAlpha:function(){return this._a},getBrightness:function(){var e=this.toRgb();return(299*e.r+587*e.g+114*e.b)/1e3},getLuminance:function(){var t,n,o,s=this.toRgb();return t=s.r/255,n=s.g/255,o=s.b/255,.2126*(t<=.03928?t/12.92:e.pow((t+.055)/1.055,2.4))+.7152*(n<=.03928?n/12.92:e.pow((n+.055)/1.055,2.4))+.0722*(o<=.03928?o/12.92:e.pow((o+.055)/1.055,2.4))},setAlpha:function(e){return this._a=L(e),this._roundA=s(100*this._a)/100,this},toHsv:function(){var e=d(this._r,this._g,this._b);return{h:360*e.h,s:e.s,v:e.v,a:this._a}},toHsvString:function(){var e=d(this._r,this._g,this._b),t=s(360*e.h),n=s(100*e.s),o=s(100*e.v);return 1==this._a?"hsv("+t+", "+n+"%, "+o+"%)":"hsva("+t+", "+n+"%, "+o+"%, "+this._roundA+")"},toHsl:function(){var e=c(this._r,this._g,this._b);return{h:360*e.h,s:e.s,l:e.l,a:this._a}},toHslString:function(){var e=c(this._r,this._g,this._b),t=s(360*e.h),n=s(100*e.s),o=s(100*e.l);return 1==this._a?"hsl("+t+", "+n+"%, "+o+"%)":"hsla("+t+", "+n+"%, "+o+"%, "+this._roundA+")"},toHex:function(e){return u(this._r,this._g,this._b,e)},toHexString:function(e){return"#"+this.toHex(e)},toHex8:function(e){return function(e,t,n,o,r){var i=[E(s(e).toString(16)),E(s(t).toString(16)),E(s(n).toString(16)),E(B(o))];if(r&&i[0].charAt(0)==i[0].charAt(1)&&i[1].charAt(0)==i[1].charAt(1)&&i[2].charAt(0)==i[2].charAt(1)&&i[3].charAt(0)==i[3].charAt(1))return i[0].charAt(0)+i[1].charAt(0)+i[2].charAt(0)+i[3].charAt(0);return i.join("")}(this._r,this._g,this._b,this._a,e)},toHex8String:function(e){return"#"+this.toHex8(e)},toRgb:function(){return{r:s(this._r),g:s(this._g),b:s(this._b),a:this._a}},toRgbString:function(){return 1==this._a?"rgb("+s(this._r)+", "+s(this._g)+", "+s(this._b)+")":"rgba("+s(this._r)+", "+s(this._g)+", "+s(this._b)+", "+this._roundA+")"},toPercentageRgb:function(){return{r:s(100*N(this._r,255))+"%",g:s(100*N(this._g,255))+"%",b:s(100*N(this._b,255))+"%",a:this._a}},toPercentageRgbString:function(){return 1==this._a?"rgb("+s(100*N(this._r,255))+"%, "+s(100*N(this._g,255))+"%, "+s(100*N(this._b,255))+"%)":"rgba("+s(100*N(this._r,255))+"%, "+s(100*N(this._g,255))+"%, "+s(100*N(this._b,255))+"%, "+this._roundA+")"},toName:function(){return 0===this._a?"transparent":!(this._a<1)&&(T[u(this._r,this._g,this._b,!0)]||!1)},toFilter:function(e){var t="#"+p(this._r,this._g,this._b,this._a),n=t,o=this._gradientType?"GradientType = 1, ":"";if(e){var s=l(e);n="#"+p(s._r,s._g,s._b,s._a)}return"progid:DXImageTransform.Microsoft.gradient("+o+"startColorstr="+t+",endColorstr="+n+")"},toString:function(e){var t=!!e;e=e||this._format;var n=!1,o=this._a<1&&this._a>=0;return t||!o||"hex"!==e&&"hex6"!==e&&"hex3"!==e&&"hex4"!==e&&"hex8"!==e&&"name"!==e?("rgb"===e&&(n=this.toRgbString()),"prgb"===e&&(n=this.toPercentageRgbString()),"hex"!==e&&"hex6"!==e||(n=this.toHexString()),"hex3"===e&&(n=this.toHexString(!0)),"hex4"===e&&(n=this.toHex8String(!0)),"hex8"===e&&(n=this.toHex8String()),"name"===e&&(n=this.toName()),"hsl"===e&&(n=this.toHslString()),"hsv"===e&&(n=this.toHsvString()),n||this.toHexString()):"name"===e&&0===this._a?this.toName():this.toRgbString()},clone:function(){return l(this.toString())},_applyModification:function(e,t){var n=e.apply(null,[this].concat([].slice.call(t)));return this._r=n._r,this._g=n._g,this._b=n._b,this.setAlpha(n._a),this},lighten:function(){return this._applyModification(f,arguments)},brighten:function(){return this._applyModification(b,arguments)},darken:function(){return this._applyModification(v,arguments)},desaturate:function(){return this._applyModification(h,arguments)},saturate:function(){return this._applyModification(g,arguments)},greyscale:function(){return this._applyModification(m,arguments)},spin:function(){return this._applyModification(y,arguments)},_applyCombination:function(e,t){return e.apply(null,[this].concat([].slice.call(t)))},analogous:function(){return this._applyCombination(_,arguments)},complement:function(){return this._applyCombination(k,arguments)},monochromatic:function(){return this._applyCombination(D,arguments)},splitcomplement:function(){return this._applyCombination(I,arguments)},triad:function(){return this._applyCombination(x,arguments)},tetrad:function(){return this._applyCombination(w,arguments)}},l.fromRatio=function(e,t){if("object"==typeof e){var n={};for(var o in e)e.hasOwnProperty(o)&&(n[o]="a"===o?e[o]:A(e[o]));e=n}return l(e,t)},l.equals=function(e,t){return!(!e||!t)&&l(e).toRgbString()==l(t).toRgbString()},l.random=function(){return l.fromRatio({r:a(),g:a(),b:a()})},l.mix=function(e,t,n){n=0===n?0:n||50;var o=l(e).toRgb(),s=l(t).toRgb(),r=n/100;return l({r:(s.r-o.r)*r+o.r,g:(s.g-o.g)*r+o.g,b:(s.b-o.b)*r+o.b,a:(s.a-o.a)*r+o.a})},l.readability=function(t,n){var o=l(t),s=l(n);return(e.max(o.getLuminance(),s.getLuminance())+.05)/(e.min(o.getLuminance(),s.getLuminance())+.05)},l.isReadable=function(e,t,n){var o,s,r=l.readability(e,t);switch(s=!1,(o=function(e){var t,n;t=((e=e||{level:"AA",size:"small"}).level||"AA").toUpperCase(),n=(e.size||"small").toLowerCase(),"AA"!==t&&"AAA"!==t&&(t="AA");"small"!==n&&"large"!==n&&(n="small");return{level:t,size:n}}(n)).level+o.size){case"AAsmall":case"AAAlarge":s=r>=4.5;break;case"AAlarge":s=r>=3;break;case"AAAsmall":s=r>=7}return s},l.mostReadable=function(e,t,n){var o,s,r,i,a=null,c=0;s=(n=n||{}).includeFallbackColors,r=n.level,i=n.size;for(var d=0;d<t.length;d++)(o=l.readability(e,t[d]))>c&&(c=o,a=l(t[d]));return l.isReadable(e,a,{level:r,size:i})||!s?a:(n.includeFallbackColors=!1,l.mostReadable(e,["#fff","#000"],n))};var C=l.names={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"663399",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"},T=l.hexNames=function(e){var t={};for(var n in e)e.hasOwnProperty(n)&&(t[e[n]]=n);return t}(C);function L(e){return e=parseFloat(e),(isNaN(e)||e<0||e>1)&&(e=1),e}function N(t,n){(function(e){return"string"==typeof e&&-1!=e.indexOf(".")&&1===parseFloat(e)})(t)&&(t="100%");var o=function(e){return"string"==typeof e&&-1!=e.indexOf("%")}(t);return t=r(n,i(0,parseFloat(t))),o&&(t=parseInt(t*n,10)/100),e.abs(t-n)<1e-6?1:t%n/parseFloat(n)}function M(e){return r(1,i(0,e))}function S(e){return parseInt(e,16)}function E(e){return 1==e.length?"0"+e:""+e}function A(e){return e<=1&&(e=100*e+"%"),e}function B(t){return e.round(255*parseFloat(t)).toString(16)}function j(e){return S(e)/255}var O,R,z,H=(R="[\\s|\\(]+("+(O="(?:[-\\+]?\\d*\\.\\d+%?)|(?:[-\\+]?\\d+%?)")+")[,|\\s]+("+O+")[,|\\s]+("+O+")\\s*\\)?",z="[\\s|\\(]+("+O+")[,|\\s]+("+O+")[,|\\s]+("+O+")[,|\\s]+("+O+")\\s*\\)?",{CSS_UNIT:new RegExp(O),rgb:new RegExp("rgb"+R),rgba:new RegExp("rgba"+z),hsl:new RegExp("hsl"+R),hsla:new RegExp("hsla"+z),hsv:new RegExp("hsv"+R),hsva:new RegExp("hsva"+z),hex3:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex4:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex8:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/});function Z(e){return!!H.CSS_UNIT.exec(e)}return l}(Math);t.a=o},1504:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var o=n(1497);const s={block:null,timerID:null};class r{constructor(e){this.addon=e,this.addon.tab.traps.getBlockly().then(e=>{this.blockly=e}),this.vm=this.addon.tab.traps.vm,this.offsetX=32,this.offsetY=32,this.navigationHistory=new i(this),this._workspace=null}getEditingTarget(){return this.vm.runtime.getEditingTarget()}setEditingTarget(e){this.getEditingTarget().id!==e&&this.vm.setEditingTarget(e)}getWorkspace(){const e=Blockly.getMainWorkspace();return e.getToolbox()&&(this._workspace=e),this._workspace}scrollBlockIntoView(e){var t;let n,r=this.getWorkspace();if(e instanceof o.a?(this.setEditingTarget(e.targetId),n=r.getBlockById(e.id)):n=e&&e.id?e:r.getBlockById(e),!n)return;let i=n.getRootBlock(),a=this.getTopOfStackFor(n).getRelativeToSurfaceXY(),l=i.getRelativeToSurfaceXY(),c=r.scale,d=l.x*c,u=a.y*c,p=n.width+d,h=n.height+u,g=r.getMetrics();if(d<g.viewLeft+this.offsetX-4||p>g.viewLeft+g.viewWidth||u<g.viewTop+this.offsetY-4||h>g.viewTop+g.viewHeight){let e=d-g.contentLeft-this.offsetX,t=u-g.contentTop-this.offsetY;this.navigationHistory.storeView(this.navigationHistory.peek(),64),r.scrollbar.set(e,t),this.navigationHistory.storeView({left:e,top:t},64)}null===(t=this.blockly)||void 0===t||t.hideChaff(),class{static flash(e){s.timerID>0&&(clearTimeout(s.timerID),s.block.svgPath_&&(s.block.svgPath_.style.fill=""));let t=4,n=!0;s.block=e,function e(){s.block.svgPath_&&(s.block.svgPath_.style.fill=n?"#ffff80":""),n=!n,t--,t>0?s.timerID=setTimeout(e,200):(s.timerID=0,s.block=null)}()}}.flash(n)}getTopOfStackFor(e){let t=e;for(;t.getOutputShape()&&t.getSurroundParent();)t=t.getSurroundParent();return t}}class i{constructor(e){this.utils=e,this.views=[],this.forward=[]}storeView(e,t){this.forward=[];let n=this.utils.getWorkspace().getMetrics(),o={left:n.viewLeft,top:n.viewTop};(!e||a(o,e)>t)&&this.views.push(o)}peek(){return this.views.length>0?this.views[this.views.length-1]:null}goBack(){const e=this.utils.getWorkspace(),t=e.getMetrics();let n={left:t.viewLeft,top:t.viewTop},o=this.peek();if(!o)return;if(a(n,o)<64&&this.views.length>1&&(this.views.pop(),this.forward.push(o)),o=this.peek(),!o)return;let s=o.left-t.contentLeft,r=o.top-t.contentTop;e.scrollbar.set(s,r)}goForward(){let e=this.forward.pop();if(!e)return;this.views.push(e);let t=this.utils.getWorkspace(),n=t.getMetrics(),o=e.left-n.contentLeft,s=e.top-n.contentTop;t.scrollbar.set(o,s)}}function a(e,t){return Math.sqrt(Math.pow(e.left-t.left,2)+Math.pow(e.top-t.top,2))}},1540:function(e,t,n){(e.exports=n(9)(!1)).push([e.i,'#s3devToolBar {\n  display: flex;\n  white-space: nowrap;\n  font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;\n}\n\n.s3devLabel {\n  display: flex;\n  padding-right: 2em;\n}\n\n[dir="rtl"] .s3devLabel {\n  padding-right: 0;\n  padding-left: 2em;\n}\n\n.s3devLabel > span:first-child {\n  margin-left: 1.5em;\n  margin-right: 1em;\n  font-weight: bold;\n  font-size: 0.625rem;\n  user-select: none;\n  cursor: default;\n  white-space: nowrap;\n  padding-top: 2px;\n}\n\n[dir="rtl"] .s3devLabel > span:first-child {\n  margin-right: 1.5em;\n  margin-left: 1em;\n}\n\n.s3devAction {\n  transition: opacity 200ms ease-in;\n  /*font-weight: bold;*/\n  opacity: 0;\n}\n\n.s3devLabel:hover .s3devAction {\n  opacity: 0.7;\n}\n\n/* Wrapper around find button and drop down */\n.s3devWrap {\n  overflow: visible;\n  /*margin-left:3em;*/\n  position: relative;\n}\n\n#s3devFind {\n  height: 2rem;\n}\n\n/* Find Input Box */\ninput.s3devInp {\n  min-width: 100%;\n  box-sizing: border-box !important;\n  /* !important required for extension, because CSS injection method (and hence order) differs from addon */\n  height: 1.5rem;\n\n  /* Change Scratch default styles */\n  border-radius: 0.25rem;\n  font-size: 0.75rem;\n  padding-left: 0.4em;\n}\n[theme="dark"] input.s3devInp {\n  color: #eee;\n  background: #3333;\n}\n[theme="dark"] input.s3devInp:hover {\n  background: #333;\n}\n\ninput.s3devInp:focus {\n  /* Change Scratch default styles */\n  box-shadow: none;\n}\n\n/* Drop down from find button */\n#s3devDDOut {\n  top: -6px;\n}\n\n/* Drop down from find button */\ndiv.s3devDDOut {\n  z-index: 100;\n  left: 0;\n  width: 16em;\n  position: relative;\n  /*padding: 2.2em 0 0;*/\n  /*background-color: white;*/\n  padding: 4px;\n}\n\n/* Drop down from find button */\nul.s3devDD {\n  display: none;\n  position: relative;\n  padding: 0.2em 0;\n  font-size: 0.75rem;\n  line-height: 1;\n  overflow-y: auto;\n  min-height: 128px;\n  max-height: 65vh;\n  user-select: none;\n  max-width: 100%;\n}\n\ndiv.s3devDDOut.vis {\n  /*box-shadow: 0 2px 3px rgba(0,0,0,0.3), 0 5px 8px rgba(0,0,0,0.2);*/\n  box-shadow: 0px 0px 8px 1px rgba(0, 0, 0, 0.3);\n  background-color: white;\n  border: none;\n  border-radius: 4px;\n}\n[theme="dark"] div.s3devDDOut.vis {\n  background-color: #111;\n}\n\ndiv.s3devDDOut.vis ul.s3devDD {\n  display: block;\n  border: none;\n}\n\n/* Drop down items */\n.s3devDD > li {\n  display: block;\n  padding: 0.5em 0.3em;\n  white-space: nowrap;\n  margin: 0;\n  font-weight: bold;\n  text-overflow: ellipsis;\n  overflow: hidden;\n}\n\n.s3devDD > li > b {\n  background-color: #aaffaa;\n  color: black;\n}\n\n/* Drop down items */\n.s3devDD > li:hover,\n.s3devDD > li.sel {\n  color: white;\n  cursor: pointer;\n}\n\n#s3devDD > li::before {\n  content: "\\25CF   "; /* ● */\n}\n\n.define {\n  color: rgb(255, 102, 128);\n}\n.define:hover,\n.define.sel {\n  background-color: rgb(255, 102, 128);\n}\n\n.flag {\n  color: #4cbf56;\n}\n.flag:hover,\n.flag.sel {\n  background-color: #4cbf56;\n}\n\n.receive {\n  color: rgb(255, 191, 0);\n}\n.receive:hover,\n.receive.sel {\n  background-color: rgb(255, 191, 0);\n}\n\n.event {\n  color: rgb(255, 191, 0);\n}\n.event:hover,\n.event.sel {\n  background-color: rgb(255, 191, 0);\n}\n\n.var,\n.VAR {\n  color: rgb(255, 120, 26);\n}\n.var:hover,\n.var.sel,\n.VAR:hover,\n.VAR.sel {\n  background-color: rgb(255, 120, 26);\n}\n\n.list,\n.LIST {\n  color: rgb(255, 102, 26);\n}\n.list:hover,\n.list.sel,\n.LIST:hover,\n.LIST.sel {\n  background-color: rgb(255, 102, 26);\n}\n\n.costume {\n  color: rgb(26, 66, 255);\n}\n.costume:hover,\n.costume.sel {\n  background-color: rgb(26, 66, 255);\n}\n\n.operators {\n  background-color: rgb(64, 191, 74);\n  color: rgb(56, 148, 56);\n}\n.operators:hover,\n.operators.sel {\n  background-color: rgb(56, 148, 56);\n}\n\n.data {\n  background-color: rgb(255, 140, 26);\n  color: rgb(219, 110, 0);\n}\n.data:hover,\n.data.sel {\n  background-color: rgb(219, 110, 0);\n}\n\n.data-lists {\n  background-color: rgb(255, 102, 26);\n  color: rgb(255, 102, 26);\n}\n.data-lists:hover,\n.data-lists.sel {\n  background-color: rgb(207, 81, 20);\n}\n\n.sensing {\n  background-color: rgb(76, 191, 230);\n  color: rgb(46, 142, 184);\n}\n.sensing:hover,\n.sensing.sel {\n  background-color: rgb(46, 142, 184);\n}\n\n.looks {\n  background-color: rgb(153, 102, 255);\n  color: rgb(119, 77, 203);\n}\n.looks:hover,\n.looks.sel {\n  background-color: rgb(119, 77, 203);\n}\n\n.sounds {\n  background-color: rgb(214, 92, 214);\n  color: rgb(189, 66, 189);\n}\n.sounds:hover,\n.sounds.sel {\n  background-color: rgb(189, 66, 189);\n}\n\n.motion {\n  background-color: rgb(76, 151, 255);\n  color: rgb(51, 115, 204);\n}\n.motion:hover,\n.motion.sel {\n  background-color: rgb(51, 115, 204);\n}\n\n.events {\n  background-color: rgb(255, 213, 0);\n  color: rgb(204, 153, 0);\n}\n.events:hover,\n.events.sel {\n  background-color: rgb(204, 153, 0);\n}\n\n.control {\n  background-color: rgb(255, 171, 25);\n  color: rgb(207, 139, 23);\n}\n.control:hover,\n.control.sel {\n  background-color: rgb(207, 139, 23);\n}\n\n.TurboWarp {\n  background-color: #ff4c4c;\n  color: rgb(207, 139, 23);\n}\n.TurboWarp:hover,\n.TurboWarp.sel {\n  background-color: #e64444;\n}\n\n.null {\n  background-color: rgb(255, 102, 128);\n  color: rgb(255, 77, 106);\n}\n.null:hover,\n.null.sel {\n  background-color: rgb(255, 77, 106);\n}\n\n.extension {\n  background-color: rgb(15 189 140);\n}\n.extension:hover,\n.extension.sel {\n  background-color: rgb(11 158 117);\n}\n\n/*.s3devDD>li.hat::before {                           content: \'◠ \';}*/\n/*.s3devDD>li.hat::before {                           content: \'▲ \';}*/\n/*.s3devDD>li.block::before {                         content: \'■ \';}*/\n/*.s3devDD>li.reporter::before {                      content: \'● \';}*/\n/*.s3devDD>li.boolean::before {                       content: \'◆ \';}*/\n\n#s3devIDD > li {\n  height: 19px;\n  padding: 3px 8px;\n  margin: 2px 0.3em;\n  box-sizing: border-box;\n  position: relative;\n  color: white;\n  font-weight: bold;\n  width: min-content;\n}\n\n.s3devDD > li.hat {\n  border-radius: 14px 14px 3px 3px;\n}\n.s3devDD > li.block {\n  border-radius: 3px;\n}\n.s3devDD > li.reporter {\n  border-radius: 10px;\n}\n\n.s3devDD > li.boolean {\n  width: min-content;\n}\n.s3devDD > li.boolean::before {\n  content: "";\n  position: absolute;\n  left: 0;\n  top: 0;\n  width: 0;\n  height: 0;\n  border-right: 9px solid transparent;\n  border-top: 9px solid white;\n  border-bottom: 10px solid white;\n}\n.s3devDD > li.boolean::after {\n  content: "";\n  position: absolute;\n  right: 0;\n  top: 0;\n  width: 0;\n  height: 0;\n  border-left: 9px solid transparent;\n  border-top: 9px solid white;\n  border-bottom: 10px solid white;\n}\n[theme="dark"] .s3devDD > li.boolean::before {\n  border-top-color: #111;\n  border-bottom-color: #111;\n}\n[theme="dark"] .s3devDD > li.boolean::after {\n  border-top-color: #111;\n  border-bottom-color: #111;\n}\n\n#s3devOverlay {\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background-color: rgba(80, 80, 80, 0.5);\n  z-index: 9999;\n  padding: 10em;\n  color: white;\n  font-weight: bold;\n}\n\n.s3devMulti {\n  font-weight: normal;\n  position: absolute;\n  right: 0;\n  white-space: nowrap;\n  background-color: inherit;\n  z-index: 1;\n  padding: 0;\n}\n\n.s3devNav {\n  padding: 0 6px;\n}\n\n.s3devNav:hover {\n  color: #ffff80;\n}\n\n.s3devAction {\n  margin-left: 2em;\n  font-size: 12px;\n  font-weight: bold;\n  line-height: 2;\n}\n\n@media screen and (max-width: 1180px) {\n  .s3devAction {\n    display: none;\n  }\n}\n\n.s3devHide {\n  display: none;\n}\n\n.s3dev-mi:hover {\n  background-color: #d6e9f8;\n}\n[theme="dark"] .s3dev-mi:hover {\n  background-color: var(--ui-tertiary);\n}\n\n#s3devHelpPop > div {\n  box-sizing: border-box;\n  width: 800px;\n  height: 60vh;\n  max-height: 800px;\n  max-width: 85%;\n  margin: auto;\n  margin-top: 20vh;\n}\n\n#s3devHelpPop [class*="modal_header-item-title"] {\n  margin: 0 -20rem 0 0;\n}\n#s3devHelpPop[dir="rtl"] [class*="modal_header-item-title"] {\n  margin: 0 0 0 -20rem;\n}\n\n#s3devHelpContent {\n  height: calc(100% - 3.125rem);\n  overflow-y: auto;\n  padding: 1em 2em 4em;\n  background-color: white;\n  user-select: text;\n}\n[theme="dark"] #s3devHelpPop > div {\n  background: #111;\n}\n\n#s3devFloatingBar {\n  display: flex;\n  white-space: nowrap;\n  font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;\n\n  position: absolute;\n  min-width: 128px;\n  background-color: white;\n  border-radius: 4px;\n  box-shadow: rgba(0, 0, 0, 0.3) 0 0 3px, rgba(0, 0, 0, 0.2) 0 3px 10px;\n\n  z-index: 999;\n}\n[theme="dark"] #s3devFloatingBar {\n  background-color: #111;\n}\n\n#s3devInsertLabel {\n  padding: 0;\n  align-items: center;\n}\n\n/* Drop down from find button */\nul#s3devIDD {\n  max-height: 200px;\n  margin-bottom: 0;\n}\n\n#s3devIDD > li > b {\n  background-color: rgba(0, 0, 0, 0.6);\n  color: white;\n}\n\n[data-highlighted="true"] {\n  background-color: hsla(30, 100%, 55%, 1) !important; /* orange */\n  color: white !important;\n}\n',""])},1541:function(e,t,n){(e.exports=n(9)(!1)).push([e.i,".u-dropdown-searchbar {\n  width: 100%;\n  box-sizing: border-box;\n  /* based on styles for the title input */\n  color: white;\n  background-color: hsla(0, 100%, 100%, 0.25);\n  border: 1px solid hsla(0, 0%, 0%, 0.15);\n  padding: 0.5rem;\n  outline: none;\n  transition: 0.25s ease-out;\n  font-size: 13px;\n  font-weight: bold;\n  border-radius: 4px;\n}\n.u-dropdown-searchbar:hover {\n  background-color: hsla(0, 100%, 100%, 0.5);\n}\n.u-dropdown-searchbar:focus {\n  background-color: white;\n  color: black;\n}\n.blocklyDropDownDiv .goog-menu {\n  overflow-x: hidden;\n}\n",""])},1565:function(e,t,n){(e.exports=n(9)(!1)).push([e.i,'.sa-color-picker {\n  display: flex;\n}\n\n.sa-color-picker-code {\n  margin: 8px 0;\n}\n\n.sa-color-picker-paint {\n  margin-top: 16px;\n  margin-bottom: 4px;\n}\n\n.sa-color-picker > .sa-color-picker-color {\n  border: none;\n  border-top-left-radius: 1rem;\n  border-bottom-left-radius: 1rem;\n  padding: 0;\n  padding-left: 0.6rem;\n  padding-right: 0.4rem;\n  margin-left: 0.5rem;\n  outline: none;\n  box-sizing: border-box;\n  width: 3rem;\n  height: 2rem;\n}\n[theme="dark"] .sa-color-picker > .sa-color-picker-color {\n  background: var(--ui-secondary);\n}\n\n.sa-color-picker > .sa-color-picker-text {\n  box-sizing: border-box;\n  width: calc(150px - 3rem);\n  border-top-left-radius: 0;\n  border-bottom-left-radius: 0;\n}\n\n[dir="rtl"] .sa-color-picker > .sa-color-picker-color {\n  border-top-left-radius: 0;\n  border-bottom-left-radius: 0;\n  border-top-right-radius: 1rem;\n  border-bottom-right-radius: 1rem;\n  margin-left: 0;\n  margin-right: 0.5rem;\n}\n\n[dir="rtl"] .sa-color-picker > .sa-color-picker-text {\n  border-top-left-radius: 1rem;\n  border-bottom-left-radius: 1rem;\n  border-top-right-radius: 0;\n  border-bottom-right-radius: 0;\n}\n\nbody.sa-hide-eye-dropper-background div[class*="stage_color-picker-background"] {\n  /* Do not show eye dropper background if the color picker is "fake" */\n  display: none;\n}\n',""])},1566:function(e,t,n){(e.exports=n(9)(!1)).push([e.i,'.sa-onion-controls-container {\n  display: flex;\n  flex-direction: row;\n  height: calc(1.95rem + 2px);\n}\n\n.sa-onion-button {\n  position: relative;\n}\n.sa-onion-button:focus-within {\n  background-color: hsla(0, 100%, 65%, 0.2);\n}\n.sa-onion-button[data-enabled="true"] {\n  background-color: #ff4c4c;\n}\n\n.sa-onion-settings {\n  position: absolute;\n  bottom: 0;\n  right: 16px;\n  /* based on the styles for the color dropdown */\n  padding: 4px;\n  border-radius: 4px;\n  border: 1px solid #ddd;\n  box-shadow: 0px 0px 8px 1px rgba(0, 0, 0, 0.3);\n  transition-property: bottom, opacity;\n  transition-duration: 500ms;\n  transition-timing-function: cubic-bezier(0.23, 1, 0.32, 1);\n  opacity: 0;\n  pointer-events: none;\n  background: white;\n  color: black;\n}\n.sa-onion-settings[data-visible="true"] {\n  bottom: 16px;\n  pointer-events: auto;\n  opacity: 1;\n}\n[dir="rtl"] .sa-onion-settings {\n  right: initial;\n  left: 24px;\n}\n.sa-onion-settings .sa-onion-button {\n  border-color: #d9d9d9 !important; /* override dark mode */\n}\n\n.sa-onion-settings-line {\n  display: flex;\n  justify-content: flex-end;\n  align-items: baseline;\n}\n\n.sa-onion-settings-input {\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n  box-sizing: border-box;\n  text-align: center;\n  border: 0;\n  background: transparent;\n  -moz-appearance: textfield;\n  border: 0;\n  outline: 0;\n}\n\n.sa-onion-settings-input::-webkit-outer-spin-button,\n.sa-onion-settings-input::-webkit-inner-spin-button {\n  -webkit-appearance: none;\n  margin: 0;\n}\n\n.sa-onion-settings-tip {\n  position: absolute;\n  bottom: 0;\n  transform: translateY(100%);\n  right: 138px;\n}\n[dir="rtl"] .sa-onion-settings-tip {\n  right: 84px;\n}\n.sa-onion-settings-polygon {\n  fill: white;\n  stroke: #ddd;\n}\n\n[theme="dark"] .sa-onion-image[data-image="settings"] {\n  filter: invert(1);\n}\n[theme="dark"] .sa-onion-image[data-image="increment"] {\n  filter: none;\n}\n[theme="dark"] .sa-onion-image[data-image="decrement"] {\n  filter: none;\n}\n',""])},1581:function(e,t,n){(e.exports=n(9)(!1)).push([e.i,'.sa-folders-contextmenu-item {\n  max-width: 250px;\n  overflow: hidden;\n  text-overflow: ellipsis;\n}\n\n[sa-folders-context-type="folder"] .react-contextmenu > :not(.sa-ctx-menu) {\n  display: none;\n}\n',""])},1592:function(e,t,n){(e.exports=n(9)(!1)).push([e.i,".sa-comment-preview-outer {\n  position: fixed;\n  top: 0;\n  left: 0;\n  z-index: 100000000;\n  pointer-events: none;\n}\n\n.sa-comment-preview-inner {\n  width: calc(200px - 16px);\n  max-height: calc(132px - 8px);\n  padding: 8px;\n  overflow: hidden;\n\n  font-size: 12px;\n  white-space: pre-wrap;\n  pointer-events: none;\n\n  color: rgb(87, 94, 117);\n  background-color: rgb(255 255 255 / 90%);\n  border-style: none;\n  border-radius: 8px;\n  filter: drop-shadow(0px 5px 5px rgb(0 0 0 / 10%));\n\n  transform: perspective(200px);\n}\n\n@supports (backdrop-filter: blur(16px)) {\n  .sa-comment-preview-inner {\n    background-color: rgb(255 255 255 / 75%);\n    backdrop-filter: blur(16px);\n  }\n}\n\n.sa-comment-preview-fade {\n  transition: opacity 0.1s, filter 0.1s, transform 0.1s linear;\n}\n\n.sa-comment-preview-hidden {\n  opacity: 0;\n  filter: none;\n  transform: perspective(200px) translateZ(-20px);\n}\n\n.sa-comment-preview-reduce-transparency {\n  background-color: rgb(255 255 255);\n  backdrop-filter: none;\n}\n",""])},1603:function(e,t,n){"use strict";n.r(t),n.d(t,"resources",(function(){return v}));var o=n(1504);class s{constructor(e){this.addon=e,this.vm=e.tab.traps.vm,this.events=[]}triggerDragAndDrop(e,t,n,o){o=o||!1;let s=function(e,t,n,s){let r=document.createEvent("MouseEvents");r.initMouseEvent(e,!0,!0,window,1,1,1,n,s,o,!1,!1,!1,0,t),t.dispatchEvent(r)},r=e,i=t;if(!r)return!1;let a=r.getBoundingClientRect(),l=Math.floor((a.left+a.right)/2),c=Math.floor((a.top+a.bottom)/2);if(s("mouseover",r,l,c),s("mousedown",r,l,c),s("dragstart",r,l,c),s("drag",r,l,c),s("mousemove",r,l,c),!i){if(n){let e=n.x,t=n.y;s("drag",r,e,t),s("mousemove",r,e,t)}return!1}a=i.getBoundingClientRect();let d=Math.floor((a.left+a.right)/2),u=Math.floor((a.top+a.bottom)/2);return s("drag",r,d,u),s("mousemove",i,d,u),s("mouseenter",i,d,u),s("dragenter",i,d,u),s("mouseover",i,d,u),s("dragover",i,d,u),s("drop",i,d,u),s("dragend",r,d,u),s("mouseup",r,d,u),!0}bindOnce(e,t,n,o){o=!!o,e.removeEventListener(t,n,o),e.addEventListener(t,n,o),this.events.push(new r(e,t,n,o))}unbindAllEvents(){for(const e of this.events)e.dom.removeEventListener(e.event,e.func,e.capture);this.events=[]}}class r{constructor(e,t,n,o){this.dom=e,this.event=t,this.func=n,this.capture=o}}var i=n(1497);class a{constructor(){this.xmlDoc=document.implementation.createDocument(null,"xml")}newXml(e,t,n){let o=this.xmlDoc.createElement(t);return e.appendChild(o),this.setAttr(o,n)}setAttr(e,t){if(t)for(const n of Object.keys(t))"text"===n?e.appendChild(this.xmlDoc.createTextNode(t[n])):e.setAttribute(n,t[n]);return e}}class l{constructor(e,t,n,o){this.cls=e,this.procCode=t,this.labelID=n,this.y=o,this.lower=t.toLowerCase(),this.clones=null,this.eventName=null}matchesID(e){if(this.labelID===e)return!0;if(this.clones)for(const t of this.clones)if(t===e)return!0;return!1}}class c{static startUndoGroup(e){const t=e.undoStack_;t.length&&(t[t.length-1]._devtoolsLastUndo=!0)}static endUndoGroup(e){const t=e.undoStack_;setTimeout(()=>{const e=function(){const e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!#$%()*+,-./:;=?@[]^_`{|}~";let t="";for(let n=0;n<20;n++)t+=e[Math.floor(Math.random()*e.length)];return t}();for(let n=t.length-1;n>=0&&!t[n]._devtoolsLastUndo;n--)t[n].group=e},0)}}class d{constructor(e,t,n,r){this.addon=e,this.msg=t,this.m=n,this.vm=e.tab.traps.vm,this.utils=new o.a(e),this.domHelpers=new s(e),this.multi=new u(this.utils),this._helpHTML=r,this.find=null,this.findInp=null,this.ddOut=null,this.dd=null,this.codeTab=null,this.costTab=null,this.costTabBody=null,this.selVarID=null,this.floatInp=null,this.blockCursor=null,this.canShare=!1,this.mouseXY={x:0,y:0}}async init(){for(this.addContextMenus();;){const e=await this.addon.tab.waitForElement("ul[class*=gui_tab-list_]",{markAsSeen:!0,reduxEvents:["scratch-gui/mode/SET_PLAYER","fontsLoaded/SET_FONTS_LOADED","scratch-gui/locales/SELECT_LOCALE"],reduxCondition:e=>!e.scratchGui.mode.isPlayerOnly});this.initInner(e)}}async addContextMenus(){const e=await this.addon.tab.traps.getBlockly(),t=e.WorkspaceSvg.prototype.cleanUp,n=this;e.WorkspaceSvg.prototype.cleanUp=function(){n.addon.settings.get("enableCleanUpPlus")?n.doCleanUp():t.call(this)};let o=e.Msg.CLEAN_UP;this.addon.settings.get("enableCleanUpPlus")&&(e.Msg.CLEAN_UP=this.m("clean-plus")),this.addon.settings.addEventListener("change",()=>{this.addon.settings.get("enableCleanUpPlus")?e.Msg.CLEAN_UP=this.m("clean-plus"):e.Msg.CLEAN_UP=o}),this.addon.tab.createBlockContextMenu((t,n)=>(t.push({enabled:e.clipboardXml_,text:this.m("paste"),separator:!0,_isDevtoolsFirstItem:!0,callback:()=>{let e=this.getTopBlockIDs();document.dispatchEvent(new KeyboardEvent("keydown",{keyCode:86,ctrlKey:!0,griff:!0})),setTimeout(()=>{this.beginDragOfNewBlocksNotInIDs(e)},10)}}),t),{workspace:!0});let s=async(e,t,n)=>{let o,s,r,i,a=e=>new Promise(t=>{fetch(e).then(e=>e.blob()).then(e=>{var n=new FileReader;n.onload=function(){t(n.result)},n.readAsDataURL(e)})}),l={},c=-999999;if(o=e.svgGroup_,n)for(;"blocklyBlockCanvas"!==o.className.animVal;)o=o.parentElement;r=o.getBBox(),s=$(o).clone()[0],$(s).attr("transform","translate(30,30)"),i=s.getElementsByTagName("image");for(let e=0;e<i.length;e++){let t=$(i[e]),n=t.attr("xlink:href");n.startsWith("data")||(l[n]||(l[n]=await a(n)),t.attr("xlink:href",l[n]))}if(n){let e=[],t=[],n=s.childNodes,r=o.childNodes;for(let o=0;o<n.length;o++){let s=$(n[o]).attr("transform").split("(")[1].split(")")[0].split(",");e[o]=+s[0],t[o]=+s[1];let i=e[o]+r[o].getBBox().width;console.log(s[0],i,r[o]),i>c&&(c=i)}let i=Math.min(...e),a=Math.min(...t);c-=i,console.log(c,i);for(let o=0;o<n.length;o++){$(n[o]).attr("transform","translate(".concat(e[o]-i,",").concat(t[o]-a,")")).attr("style","")}}const d=document.createElement("canvas"),u=d.getContext("2d");let p='<svg width="999999" height="999999" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n        <style xmlns="http://www.w3.org/2000/svg">\n          .blocklyText {\n              fill: #fff;\n              font-family: "Helvetica Neue", Helvetica, sans-serif;\n              font-size: 12pt;\n              font-weight: 500;\n          }\n          .blocklyEditableText>text {\n              fill: #575E75;\n          }\n          .blocklyDropdownText {\n            fill: #fff !important;\n          }\n        </style>\n        '.concat(s.outerHTML.replaceAll("&nbsp;"," "),"\n        </svg>");const h=new Image;d.width=Math.max(c,r.width)+60,d.height=r.height+60,t&&(u.fillStyle="white",u.fillRect(0,0,d.width,r.height+60)),h.crossOrigin="Anonymous",h.src=URL.createObjectURL(new Blob([p],{type:"image/svg+xml"})),console.log(h.src),h.onload=()=>{u.drawImage(h,0,0),d.toBlob(async t=>{console.log(e,r),console.log(URL.createObjectURL(t));const n=[new ClipboardItem({[t.type]:t})];navigator.clipboard.write(n)})}};this.addon.tab.createBlockContextMenu((e,t)=>(e.push({enabled:!0,text:this.m("make-space"),_isDevtoolsFirstItem:!0,callback:()=>{this.doCleanUp(t)},separator:!0},{enabled:!0,text:this.m("copy-all"),callback:()=>{this.eventCopyClick(t)},separator:!0},{enabled:!0,text:this.m("copy-block"),callback:()=>{this.eventCopyClick(t,1)}},{enabled:!0,text:this.m("cut-block"),callback:()=>{this.eventCopyClick(t,2)}},{enabled:!0,text:"复制为图片(透明背景)",callback:()=>s(t,0)},{enabled:!0,text:"复制为图片(白色背景)",callback:()=>s(t,1)},{enabled:!0,text:"复制所有为图片(透明背景)",callback:()=>s(t,0,1)},{enabled:!0,text:"复制所有为图片(白色背景)",callback:()=>s(t,1,1)}),e),{blocks:!0}),this.addon.tab.createBlockContextMenu((e,t)=>("data"!==t.getCategory()&&"data-lists"!==t.getCategory()||(this.selVarID=t.getVars()[0],e.push({enabled:!0,text:this.m("swap",{var:"data"===t.getCategory()?this.m("variables"):this.m("lists")}),callback:()=>{let e=this.utils.getWorkspace().getVariableById(this.selVarID),t=window.prompt(this.msg("replace",{name:e.name}));t&&this.doReplaceVariable(this.selVarID,t,e.type)},separator:!0})),e),{blocks:!0,flyout:!0})}isScriptEditor(){return this.codeTab.className.indexOf("gui_is-selected")>=0}isCostumeEditor(){return this.costTab.className.indexOf("gui_is-selected")>=0}eventClickHelp(e){document.getElementById("s3devHelpPop")||(document.body.insertAdjacentHTML("beforeend",this._helpHTML),document.getElementById("s3devHelpPop").addEventListener("mousedown",(function(e){"s3devHelpPop"===e.target.id&&e.target.remove()})),document.querySelector("#s3devHelpPop .close-button").addEventListener("click",(function(e){document.getElementById("s3devHelpPop").remove()}))),e.preventDefault()}getScratchCostumes(){let e=this.costTabBody.querySelectorAll("div[class^='sprite-selector-item_sprite-name']"),t=[],n={};function o(e,o,s){let r=s.className,i=new l(e,o,r,0);return t.push(i),n[o]=i,i}let s=0;for(const t of e)o("costume",t.innerText,t).y=s,s++;return{procs:t}}getScratchBlocks(){let e=[],t={},n=this.utils.getWorkspace(),o=n.getTopBlocks();function s(n,o,s){let r=s.id?s.id:s.getId?s.getId():null,i=t[o];if(i)return i.clones||(i.clones=[]),i.clones.push(r),i;let a=new l(n,o,r,0);return a.y=s.getRelativeToSurfaceXY?s.getRelativeToSurfaceXY().y:null,e.push(a),t[o]=a,a}function r(e){let t,n=e.inputList[0];for(const e of n.fieldRow)t=(t?t+" ":"")+e.getText();return t}for(const e of o)if("procedures_definition"!==e.type)if("event_whenflagclicked"!==e.type)if("event_whenbroadcastreceived"!==e.type)"event_when"!==e.type.substr(0,10)&&"control_start_as_clone"!==e.type||s("event",r(e),e);else try{let t=e.inputList[0].fieldRow[1].getText();s("receive","event "+t,e).eventName=t}catch(e){}else s("flag",r(e),e);else{const t=e.getChildren()[0].getProcCode();if(!t)continue;const n=e.inputList.findIndex(e=>e.fieldRow.length>0);if(-1===n)continue;const o=e.inputList[n].fieldRow[0].getText();s("define",0===n?"".concat(o," ").concat(t):"".concat(t," ").concat(o),e)}let i=n.getVariableMap(),a=i.getVariablesOfType("");for(const e of a)s(e.isLocal?"var":"VAR",(e.isLocal?"var ":"VAR ")+e.name,e);let c=i.getVariablesOfType("list");for(const e of c)s(e.isLocal?"list":"LIST",(e.isLocal?"list ":"LIST ")+e.name,e);const d=this.getCallsToEvents();for(const e of d)s("receive","event "+e.eventName,e.block).eventName=e.eventName;const u={flag:0,receive:1,event:2,define:3,var:4,VAR:5,list:6,LIST:7};return e.sort((e,t)=>{let n=u[e.cls]-u[t.cls];return 0!==n?n:e.lower<t.lower?-1:e.lower>t.lower?1:e.y-t.y}),{procs:e}}showDropDown(e,t,n){if(clearTimeout(g),g=0,!t&&this.ddOut.classList.contains("vis"))return;f=t?"":null,this.ddOut.classList.add("vis");let o=this.isCostumeEditor()?this.getScratchCostumes():this.getScratchBlocks();this.dom_removeChildren(this.dd);let s=null;const r=o.procs;for(const e of r){let n=document.createElement("li");n.innerText=e.procCode,n.data=e,n.className=e.cls,t&&(e.matchesID(t)?(s=n,n.classList.add("sel")):n.style.display="none"),this.dd.appendChild(n)}let i=document.getElementById("s3devFindLabel");this.utils.offsetX=this.ddOut.getBoundingClientRect().right-i.getBoundingClientRect().left+26,this.utils.offsetY=32,s&&this.clickDropDownRow(s,this.utils.getWorkspace(),n)}hideDropDown(){clearTimeout(g),g=setTimeout(()=>this.reallyHideDropDown(),250)}reallyHideDropDown(){this.findInp!==document.activeElement?(this.ddOut.classList.remove("vis"),g=0):this.hideDropDown()}hideFloatDropDown(){clearTimeout(m),m=setTimeout(()=>this.reallyHideFloatDropDown(),50)}reallyHideFloatDropDown(e){if(!e&&this.floatInp===document.activeElement)return void this.hideFloatDropDown();let t=document.getElementById("s3devFloatingBar");t&&t.remove(),this.floatInp=null,m=0}dom_removeChildren(e){for(;e.firstChild;)e.removeChild(e.firstChild)}getTopBlocks(){let e=this.getOrderedTopBlockColumns().cols,t=[];for(const n of e)t=t.concat(n.blocks);return t}doCleanUp(e){let t=this.utils.getWorkspace(),n=e&&e.getRootBlock();c.startUndoGroup(t);let o=this.getOrderedTopBlockColumns(!0),s=o.cols,r=o.orphans.blocks.length;if(r>0&&!e){let e=this.msg("orphaned",{count:r});if(confirm(e))for(const e of o.orphans.blocks)e.dispose();else s.unshift(o.orphans)}let i=48,a=o.maxWidths;for(const e of s){let t=64,o=0;for(const s of e.blocks){let e=s===n?380:0,r=s===n?480:72,l=s.getRelativeToSurfaceXY();i-l.x==0&&t-l.y==0||s.moveBy(i-l.x,t-l.y);let c=s.getHeightWidth();t+=c.height+r;let d=a[s.id]||0;o=Math.max(o,Math.max(c.width+e,d))}i+=o+96}let l=t.getTopComments();for(const e of l)e.setVisible&&(e.setVisible(!1),e.needsAutoPositioning_=!0,e.setVisible(!0));setTimeout(()=>{let e=this.utils.getWorkspace(),t=e.getVariableMap(),n=t.getVariablesOfType(""),o=[];for(const e of n)if(e.isLocal){let n=t.getVariableUsesById(e.getId());n&&0!==n.length||o.push(e)}if(o.length>0){const t=o.length;let n=this.msg("unused-var",{count:t});for(let e=0;e<o.length;e++){let t=o[e];e>0&&(n+=", "),n+=t.name}if(confirm(n))for(const t of o)e.deleteVariableById(t.getId())}let s=t.getVariablesOfType("list"),r=[];for(const e of s)if(e.isLocal){let n=t.getVariableUsesById(e.getId());n&&0!==n.length||r.push(e)}if(r.length>0){const t=r.length;let n=this.msg("unused-list",{count:t});for(let e=0;e<r.length;e++){let t=r[e];e>0&&(n+=", "),n+=t.name}if(confirm(n))for(const t of r)e.deleteVariableById(t.getId())}c.endUndoGroup(e)},100)}isBlockAnOrphan(e){return!!e.outputConnection}getOrderedTopBlockColumns(e){let t=this.utils.getWorkspace(),n=t.getTopBlocks(),o={};if(e){let e=t.getTopComments();for(const t of e)if(t.setVisible){t.setVisible(!1),t.needsAutoPositioning_=!0,t.setVisible(!0);let e=t.getBoundingRectangle().bottomRight.x,n=t.block_.getRootBlock(),s=n.getBoundingRectangle().topLeft.x;o[n.id]=Math.max(e-s,o[n.id]||0)}}let s=[];let r={x:-999999,count:0,blocks:[]};for(const t of n){let n=t.getRelativeToSurfaceXY(),o=null,i=256;if(e&&this.isBlockAnOrphan(t))r.blocks.push(t);else{for(const e of s){let t=Math.abs(n.x-e.x);t<i&&(i=t,o=e)}o?(o.x=(o.x*o.count+n.x)/++o.count,o.blocks.push(t)):s.push(new p(n.x,1,[t]))}}s.sort((e,t)=>e.x-t.x);for(const e of s)e.blocks.sort((e,t)=>e.getRelativeToSurfaceXY().y-t.getRelativeToSurfaceXY().y);return{cols:s,orphans:r,maxWidths:o}}getVariableUsesById(e){let t=[],n=this.getTopBlocks(!0);for(const o of n){let n=o.getDescendants();for(const o of n){let n=o.getVarModels();if(n)for(const s of n)s.getId()===e&&t.push(o)}}return t}getCallsToProcedureById(e){let t=this.utils.getWorkspace().getBlockById(e),n=t.getChildren()[0].getProcCode(),o=[t],s=this.getTopBlocks(!0);for(const e of s){let t=e.getDescendants();for(const e of t)"procedures_call"===e.type&&e.getProcCode()===n&&o.push(e)}return o}getCallsToEventsByName(e){let t=[];const n=this.vm.runtime.targets;for(const o of n){if(!o.isOriginal)continue;const n=o.blocks;if(n._blocks)for(const s of Object.keys(n._blocks)){const r=n._blocks[s];if("event_broadcast_menu"===r.opcode&&r.fields.BROADCAST_OPTION.value===e){const e=n.getBlock(r.parent);t.push(new i.a(o,e))}else"event_whenbroadcastreceived"===r.opcode&&r.fields.BROADCAST_OPTION.value===e&&t.push(new i.a(o,r))}}return t}getCallsToEvents(){const e=[],t={};let n=this.getTopBlocks(!0);for(const o of n){let n=o.getDescendants();for(const o of n)if("event_broadcast"===o.type||"event_broadcastandwait"===o.type){const n=o.getChildren()[0].inputList[0].fieldRow[0].getText();t[n]||(t[n]=o,e.push({eventName:n,block:o}))}}return e}buildNavigationCarousel(e,t,n,o){var s=this;if(e&&e.parentNode===t)this.multi.navRight();else{if(e&&e.remove(),t.insertAdjacentHTML("beforeend",'\n                    <span id="s3devMulti" class="s3devMulti">\n                        <span id="s3devMultiLeft" class="s3devNav">◀</span><span id="s3devMultiCount"></span><span id="s3devMultiRight" class="s3devNav">▶</span>\n                    </span>\n                '),document.getElementById("s3devMultiLeft").addEventListener("mousedown",(function(){return s.multi.navLeft(...arguments)})),document.getElementById("s3devMultiRight").addEventListener("mousedown",(function(){return s.multi.navRight(...arguments)})),this.multi.idx=0,o)for(let e=0;e<n.length;e++){if(n[e].id===o.id){this.multi.idx=e;break}}this.multi.blocks=n,this.multi.update(),this.multi.idx<n.length&&this.centerTop(n[this.multi.idx])}}moveCostumeTo(e,t){let n=!t||t.className.indexOf("sprite-selector-item_is-selected")>=0;if(!t){if(0===(t=this.costTabBody.querySelectorAll("div[class*='sprite-selector-item_is-selected']")).length)return;t=t[0].querySelectorAll("div[class^='sprite-selector-item_sprite-name']")[0]}let o=this.costTabBody.querySelectorAll("div[class^='sprite-selector-item_sprite-name']"),s=t.closest("div[class*=selector_list-area]"),r=s.scrollTop;s.scrollTop=e?0:s.scrollHeight,this.domHelpers.triggerDragAndDrop(t,o[e?0:o.length-1],void 0),n||(s.scrollTop=r)}clickDropDownRow(e,t,n){let o=document.getElementById("s3devMulti"),s=e.data.cls;if("costume"===s){let t=this.costTabBody.querySelectorAll("div[class^='sprite-selector-item_sprite-name']")[e.data.y];t&&(t.click(),setTimeout(()=>{let e=t.closest("div[class*=gui_flex-wrapper]");t.parentElement.parentElement.scrollIntoView({behavior:"auto",block:"center",inline:"start"}),e.scrollTop=0},10))}else if("var"===s||"VAR"===s||"list"===s||"LIST"===s){let t=this.getVariableUsesById(e.data.labelID);this.buildNavigationCarousel(o,e,t,n)}else if("define"===s){let t=this.getCallsToProcedureById(e.data.labelID);this.buildNavigationCarousel(o,e,t,n)}else if("receive"===s){let t=this.getCallsToEventsByName(e.data.eventName);if(!n){const e=this.utils.getEditingTarget().id;for(const o of t)if(o.targetId===e){n=o;break}}this.buildNavigationCarousel(o,e,t,n)}else if(e.data.clones){let s=[t.getBlockById(e.data.labelID)];for(const n of e.data.clones)s.push(t.getBlockById(n));this.buildNavigationCarousel(o,e,s,n)}else this.multi.blocks=null,this.centerTop(e.data.labelID),o&&o.remove()}dropDownClick(e){let t=this.utils.getWorkspace();null===f&&(f=this.findInp.value);let n=e.target;for(;;){if(!n||n===this.dd)return;if(n.data)break;n=n.parentNode}if(!e.navKey){let t=this.dd.getElementsByClassName("sel");if(t=t.length>0?t[0]:null,t&&t!==n)try{t.classList.remove("sel")}catch(e){console.log(t),console.error(e)}n!==t&&n.classList.add("sel")}return this.clickDropDownRow(n,t),e&&e.preventDefault&&(e.preventDefault(),e.cancelBubble=!0),!1}centerTop(e,t){this.utils.scrollBlockIntoView(e,t)}inputChange(e){this.ddOut.classList.contains("vis")||(this.showDropDown(),this.hideDropDown());let t=(this.findInp.value||"").toLowerCase();if(t===f)return;f=t,this.multi.blocks=null;let n=this.dd.getElementsByTagName("li");for(const e of n){let n=e.data.procCode,o=e.data.lower.indexOf(t);if(o>=0){e.style.display="block",this.dom_removeChildren(e),o>0&&e.appendChild(document.createTextNode(n.substring(0,o)));let s=document.createElement("b");s.appendChild(document.createTextNode(n.substr(o,t.length))),e.appendChild(s),o+t.length<n.length&&e.appendChild(document.createTextNode(n.substr(o+t.length)))}else e.style.display="none"}}navigateFilter(e){let t,n=this.dd.getElementsByClassName("sel");for(n.length>0&&"none"!==n[0].style.display?t=-1===e?n[0].previousSibling:n[n.length-1].nextSibling:(t=this.dd.children[0],e=1);t&&"none"===t.style.display;)t=-1===e?t.previousSibling:t.nextSibling;if(t){for(const e of n)e.classList.remove("sel");t.classList.add("sel"),this.dropDownClick({target:t,navKey:!0})}}inputKeyDown(e){if(38===e.keyCode)return this.navigateFilter(-1),void e.preventDefault();if(40===e.keyCode)return this.navigateFilter(1),void e.preventDefault();if(37===e.keyCode){this.dd.getElementsByClassName("sel")&&this.multi.blocks&&this.multi.navLeft(e)}if(39===e.keyCode){this.dd.getElementsByClassName("sel")&&this.multi.blocks&&this.multi.navRight(e)}if(13===e.keyCode){return 0===this.dd.getElementsByClassName("sel").length&&this.navigateFilter(1),document.activeElement.blur(),void e.preventDefault()}return 27===e.keyCode?(this.findInp.value.length>0?(this.findInp.value="",this.inputChange(e)):document.activeElement.blur(),void e.preventDefault()):void 0}doReplaceVariable(e,t,n){let o=this.utils.getWorkspace(),s=o.getVariable(t,n);if(!s)return void alert(this.msg("var-not-exist"));let r=s.getId();c.startUndoGroup(o);let i=this.getVariableUsesById(e);for(const e of i)try{""===n?e.getField("VARIABLE").setValue(r):e.getField("LIST").setValue(r)}catch(e){}c.endUndoGroup(o)}getTopBlockIDs(){let e=this.utils.getWorkspace().getTopBlocks(),t=new Set;for(const n of e)t.add(n.id);return t}beginDragOfNewBlocksNotInIDs(e){if(!this.addon.settings.get("enablePasteBlocksAtMouse"))return;let t=this.utils.getWorkspace().getTopBlocks();for(const n of t)if(!e.has(n.id)){let e={x:this.mouseXY.x,y:this.mouseXY.y};n.setIntersects(!0),this.domHelpers.triggerDragAndDrop(n.svgPath_,null,e)}}updateMousePosition(e){this.mouseXY.x=e.clientX,this.mouseXY.y=e.clientY}eventMouseMove(e){this.updateMousePosition(e)}eventKeyDown(e){function t(e){let t=this.costTabBody.querySelector("div[class*='sprite-selector-item_is-selected']"),n=e?t.parentNode.previousSibling:t.parentNode.nextSibling;if(n){let e=n.closest("div[class*=gui_flex-wrapper]");n.querySelector("div[class^='sprite-selector-item_sprite-name']").click(),n.scrollIntoView({behavior:"auto",block:"center",inline:"start"}),e.scrollTop=0}}if(document.URL.indexOf("editor")<=0)return;let n=e.ctrlKey||e.metaKey;if("f"===e.key&&n&&!e.shiftKey)return this.findInp.focus(),this.findInp.select(),e.cancelBubble=!0,e.preventDefault(),!0;if(" "===e.key&&n)return this.middleClickWorkspace(e),e.cancelBubble=!0,e.preventDefault(),!0;if(37===e.keyCode&&n){if("INPUT"===document.activeElement.tagName)return;return this.isScriptEditor()?this.utils.navigationHistory.goBack():this.isCostumeEditor()&&t(!0),e.cancelBubble=!0,e.preventDefault(),!0}if(39===e.keyCode&&n){if("INPUT"===document.activeElement.tagName)return;return this.isScriptEditor()?this.utils.navigationHistory.goForward():this.isCostumeEditor()&&t(!1),e.cancelBubble=!0,e.preventDefault(),!0}if(86===e.keyCode&&n&&!e.griff){let e=this.getTopBlockIDs();setTimeout(()=>{this.beginDragOfNewBlocksNotInIDs(e)},10)}}eventCopyClick(e,t){let n=this.utils.getWorkspace();if(e){e.select();let o=t?e.getNextBlock():null;o&&o.unplug(!1),document.dispatchEvent(new KeyboardEvent("keydown",{keyCode:67,ctrlKey:!0})),(o||2===t)&&setTimeout(()=>{o&&n.undo(),2===t&&(c.startUndoGroup(n),e.dispose(!0),c.endUndoGroup(n))},0)}}eventMouseDown(e){if(this.updateMousePosition(e),this.ddOut&&this.ddOut.classList.contains("vis")&&!e.target.closest("#s3devDDOut")&&this.hideDropDown(),this.floatInp&&!e.target.closest("#s3devIDDOut")&&(e.shiftKey&&(document.getElementsByClassName("injectionDiv")[0].contains(e.target)||e.target.classList.contains("blocklyHtmlInput"))&&!e.target.matches(".blocklyFlyoutButton, .blocklyFlyoutButton *, .blocklyTouchTargetBackground")||this.hideFloatDropDown()),1===e.button||e.shiftKey)try{this.middleClick(e)}catch(e){console.error(e)}else if(2===e.button);else{let t=e.target;if(t&&"BUTTON"!==t.tagName&&t.getAttribute&&!t.getAttribute("role")&&(t=t.parentNode,t&&"BUTTON"!==t.tagName&&t.getAttribute&&!t.getAttribute("role")&&(t=t.parentNode)),t&&t.className&&t.className.indexOf&&!this.canShare&&t.className.indexOf("share-button")>=0)return;if(t="SPAN"===e.target.tagName?e.target.parentNode:e.target,t.classList.contains("s3devSTT")&&(t.textContent===this.m("top")||t.textContent===this.m("bottom"))){let n=e.target.closest("div[class*='sprite-selector-item_sprite-selector-item']");this.moveCostumeTo(t.textContent===this.m("top"),n),e.cancelBubble=!0,e.preventDefault()}}}eventMouseUp(e){this.updateMousePosition(e),1===e.button&&e.target.closest("svg.blocklySvg")&&e.preventDefault()}middleClickWorkspace(e){var t=this;if(!this.isScriptEditor())return;e.cancelBubble=!0,e.preventDefault();let n=document.getElementById("s3devFloatingBar");n&&n.remove(),document.body.insertAdjacentHTML("beforeend",'\n            <div id="s3devFloatingBar" dir="'.concat(this.addon.tab.direction,'">\n                <label class=\'title s3devLabel\' id=s3devInsertLabel>\n                    <span style="display:none;">').concat(this.m("insert"),' </span>\n                    <span id=s3devInsert class="s3devWrap">\n                        <div id=\'s3devIDDOut\' class="s3devDDOut">\n                            <input id=\'s3devIInp\' class="').concat(this.addon.tab.scratchClass("input_input-form",{others:"s3devInp"}),"\" type='search' placeholder='").concat(this.m("start-typing"),"' autocomplete='off'>\n                            <ul id='s3devIDD' class=\"s3devDD\"></ul>\n                        </div>\n                    </span>\n                </label>\n            </div>\n        ")),n=document.getElementById("s3devFloatingBar"),n.style.left=this.mouseXY.x+16+"px",n.style.top=this.mouseXY.y-8+"px",this.floatInp=document.getElementById("s3devIInp"),this.floatInp.focus(),this.buildFloatingFilterList(e,n);document.getElementById("s3devIDDOut").addEventListener("mousedown",(function(){return t.dropDownFloatClick(...arguments)})),this.floatInp.addEventListener("keyup",(function(){return t.floatInputChange(...arguments)})),this.floatInp.addEventListener("focus",(function(){return t.floatInputChange(...arguments)})),this.floatInp.addEventListener("keydown",(function(){return t.floatInputKeyDown(...arguments)}))}middleClick(e){let t=e.target.closest("[data-id]");if(!t)return void(e.target.closest("svg.blocklySvg")&&(this.blockCursor=null,this.middleClickWorkspace(e)));if(!this.addon.settings.get("enableMiddleClickFinder"))return;let n=this.utils.getWorkspace(),o=t.getAttribute("data-id"),s=n.getBlockById(o);if(s){for(;s;s=s.getSurroundParent()){if("procedures_call"===s.type){e.cancelBubble=!0,e.preventDefault();let t=s.getProcCode(),n=this.utils.getWorkspace().getTopBlocks();for(const e of n)if("procedures_definition"===e.type){let n=e.getChildren()[0].getProcCode();if(n&&n===t)return void this.centerTop(e)}}if("procedures_definition"===s.type){let t=s.id?s.id:s.getId?s.getId():null;return this.findInp.focus(),this.showDropDown(null,t),e.cancelBubble=!0,void e.preventDefault()}if("data_variable"===s.type||"data_changevariableby"===s.type||"data_setvariableto"===s.type){let t=s.getVars()[0];return this.findInp.focus(),this.showDropDown(null,t,s),this.selVarID=t,e.cancelBubble=!0,void e.preventDefault()}if("event_whenbroadcastreceived"===s.type||"event_broadcastandwait"===s.type||"event_broadcast"===s.type){let t=s.id;return this.findInp.focus(),this.showDropDown(null,t,s),this.selVarID=t,e.cancelBubble=!0,void e.preventDefault()}}e.cancelBubble=!0,e.preventDefault()}}getEdgeTypeClass(e){switch(e.edgeShape_){case 1:return"boolean";case 2:return"reporter";default:return e.startHat_?"hat":"block"}}buildFloatingFilterList(e,t){let n=[],o=this.utils.getWorkspace().getToolbox(),s=o.flyout_.getWorkspace().getTopBlocks(),r=Blockly.Xml.workspaceToDom(o.flyout_.getWorkspace());const i={};for(const e of r.children)if("BLOCK"===e.tagName){i[e.getAttribute("id")]=e}for(const e of s)this.getBlockText(e,n,i);n.sort((e,t)=>e.desc.length<t.desc.length?-1:e.desc.length>t.desc.length?1:e.desc.localeCompare(t.desc));const a=document.getElementById("s3devIDD");let l=0;for(const e of n){const t=document.createElement("li"),n=e.desc;let o=this.getEdgeTypeClass(e.block);l++,t.innerText=n,t.data={text:n,lower:" "+n.toLowerCase(),option:e},t.className="var "+(e.block.isScratchExtension?"extension":e.block.getCategory())+" "+o,l>h&&(t.style.display="none"),a.appendChild(t)}document.getElementById("s3devIDDOut").classList.add("vis")}getBlockText(e,t,n){let o,s,r,i=n[e.id];const a=e=>{for(const t of e.inputList){let e=t.fieldRow;for(const t of e){let e;s||"blocklyText blocklyDropdownText"!==t.className_?e=t.getText():(s=t.getOptions(),r=t.name,e=s&&s.length>0?"^^":t.getText()),o=(o?o+" ":"")+e}if(t.connection){let e=t.connection.targetBlock();e&&a(e)}}};if(a(e),s)for(const n of s){let s=n[1];"string"==typeof s&&"DELETE_VARIABLE_ID"!==s&&"RENAME_VARIABLE_ID"!==s&&"NEW_BROADCAST_MESSAGE_ID"!==s&&"NEW_BROADCAST_MESSAGE_ID"!==s&&"createGlobalVariable"!==s&&"createLocalVariable"!==s&&"createGlobalList"!==s&&"createLocalList"!==s&&"createBroadcast"!==s&&t.push({desc:o.replace("^^",n[0]),block:e,dom:i,option:n,pickField:r})}else t.push({desc:o,block:e,dom:i});return o}floatInputKeyDown(e){if(38===e.keyCode)return this.navigateFloatFilter(-1),void e.preventDefault();if(40===e.keyCode)return this.navigateFloatFilter(1),void e.preventDefault();if(13===e.keyCode){return document.getElementById("s3devIDD").querySelector(".sel")&&this.dropDownFloatClick(e),e.cancelBubble=!0,void e.preventDefault()}if(27===e.keyCode){let t=document.getElementById("s3devIInp");return t.value.length>0?(t.value="",this.floatInputChange(e)):this.reallyHideFloatDropDown(!0),void e.preventDefault()}}navigateFloatFilter(e){let t,n=document.getElementById("s3devIDD"),o=n.getElementsByClassName("sel");for(o.length>0&&"none"!==o[0].style.display?t=-1===e?o[0].previousSibling:o[o.length-1].nextSibling:(t=n.children[0],e=1);t&&"none"===t.style.display;)t=-1===e?t.previousSibling:t.nextSibling;if(t){for(const e of o)e.classList.remove("sel");t.classList.add("sel")}}findNextHole(e,t){}dropDownFloatClick(e){e.cancelBubble=!0,e.target.closest("input")||e.preventDefault();let t=this.utils.getWorkspace(),n=e&&e.target;if("B"===n.tagName&&(n=n.parentNode),e instanceof MouseEvent&&"LI"!==n.tagName)return;if(!n||!n.data){n=document.getElementById("s3devIDD").querySelector(".sel")}if(!n)return;let o=(new a).xmlDoc.firstChild,s=n.data.option;if(s.option){let e=s.dom.querySelector("field[name="+s.pickField+"]");e.getAttribute("id")?(e.innerText=s.option[0],e.setAttribute("id",s.option[1]+"-"+s.option[0])):e.innerText=s.option[1],"other scripts in sprite"===s.option[1]&&s.dom.querySelector("mutation").setAttribute("hasnext","true")}o.appendChild(s.dom);let r=Blockly.Xml.domToWorkspace(o,t);e.shiftKey||this.reallyHideFloatDropDown(!0);let i=t.getBlockById(r[0]);if(this.blockCursor){let e=this.getEdgeTypeClass(s.block);"boolean"===e?this.findNextHole(this.blockCursor,""):"reporter"===e&&this.findNextHole(this.blockCursor,e)}this.domHelpers.triggerDragAndDrop(i.svgPath_,null,{x:this.mouseXY.x,y:this.mouseXY.y},e.shiftKey),e.shiftKey&&document.getElementById("s3devIInp").focus(),this.blockCursor=i}floatInputChange(e){document.getElementById("s3devIDDOut").classList.contains("vis");let t=(document.getElementById("s3devIInp").value||"").toLowerCase();if(t===f)return;f=t,this.multi.blocks=null;let n=document.getElementById("s3devIDD"),o=n.parentNode;n.remove();let s=0,r=t.split(" "),i=n.getElementsByTagName("li");for(const e of i){const t=e.data.text,n=e.data.lower;let o=0,i=[];for(let e=0;e<r.length;e++){let t=" "+r[e],s=n.indexOf(t,o);if(-1===s){i=null;break}i.push(s),o=s+t.length}if(s<h&&i){e.style.display="block",this.dom_removeChildren(e);let n=0;for(let o=0;o<i.length;o++){let s=i[o];s>n&&(e.appendChild(document.createTextNode(t.substring(n,s))),n=s);let a=document.createElement("b"),l=r[o].length;a.appendChild(document.createTextNode(t.substr(n,l))),e.appendChild(a),n+=l}n<t.length&&e.appendChild(document.createTextNode(t.substr(n))),0===s?e.classList.add("sel"):e.classList.remove("sel"),s++}else e.style.display="none",e.classList.remove("sel")}o.append(n)}initInner(e){var t=this;let n=e.childNodes;this.codeTab&&n[0]!==this.codeTab&&this.domHelpers.unbindAllEvents(),this.codeTab=n[0],this.costTab=n[1],this.costTabBody=document.querySelector("div[aria-labelledby="+this.costTab.id+"]"),document.getElementById("s3devFind")||(e.insertAdjacentHTML("beforeend","\n                <div id=\"s3devToolBar\">\n                    <label class='title s3devLabel' id=s3devFindLabel>\n                        <span>".concat(this.m("find")," ").concat(this.addon.self._isDevtoolsExtension?"":'<a href="#" class="s3devAction" id="s3devHelp" style="/*s-a*/ margin-left: 0; font-size: 10px; /*s-a*/">(?)</a>',' </span>\n                        <span id=s3devFind class="s3devWrap">\n                            <div id=\'s3devDDOut\' class="s3devDDOut">\n                                <input id=\'s3devInp\' class="').concat(this.addon.tab.scratchClass("input_input-form",{others:"s3devInp"}),"\" type='search' placeholder='").concat(this.m("find-placeholder"),'\' autocomplete=\'off\'>\n                                <ul id=\'s3devDD\' class="s3devDD"></ul>\n                            </div>\n                        </span>\n                        <a id="s3devDeep" class="s3devAction s3devHide" href="#">').concat(this.m("deep"),"</a>\n                        <div ").concat(this.addon.self._isDevtoolsExtension?"":'style="display: none;"','><a href="#" class="s3devAction" id="s3devHelp"><b>').concat(this.m("help"),'</b></a>\n                        <a href="https://www.youtube.com/griffpatch" class="s3devAction" target="_blank" id="s3devHelp" rel="noreferrer noopener">').concat(this.m("tutorials"),"</a></div>\n                    </label>\n                </div>\n            ")),this.find=document.getElementById("s3devFind"),this.findInp=document.getElementById("s3devInp"),this.ddOut=document.getElementById("s3devDDOut"),this.domHelpers.bindOnce(this.ddOut,"mousedown",(function(){return t.dropDownClick(...arguments)}),void 0),this.dd=document.getElementById("s3devDD"),this.domHelpers.bindOnce(this.findInp,"keyup",(function(){return t.inputChange(...arguments)}),void 0),this.domHelpers.bindOnce(this.findInp,"keydown",(function(){return t.inputKeyDown(...arguments)}),void 0),this.domHelpers.bindOnce(this.findInp,"focus",(function(){return t.inputChange(...arguments)}),void 0),this.domHelpers.bindOnce(document.getElementById("s3devHelp"),"click",(function(){return t.eventClickHelp(...arguments)}),void 0),this.domHelpers.bindOnce(document,"keydown",(function(){return t.eventKeyDown(...arguments)}),!0)),this.domHelpers.bindOnce(document,"mousemove",(function(){return t.eventMouseMove(...arguments)}),!0),this.domHelpers.bindOnce(document,"mousedown",(function(){return t.eventMouseDown(...arguments)}),!0),this.domHelpers.bindOnce(document,"mouseup",(function(){return t.eventMouseUp(...arguments)}),!0)}}class u{constructor(e){this.idx=0,this.blocks=null,this.selID=null,this.utils=e}update(){var e;document.getElementById("s3devMultiCount").innerText=this.blocks&&this.blocks.length>0?(e=this.idx+1+" / "+this.blocks.length,String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")):"0",this.selID=this.idx<this.blocks.length?this.blocks[this.idx].id:null}navLeft(e){return this.navSideways(e,-1)}navRight(e){return this.navSideways(e,1)}navSideways(e,t){return this.blocks&&this.blocks.length>0&&(this.idx=(this.idx+t+this.blocks.length)%this.blocks.length,this.update(),this.utils.scrollBlockIntoView(this.blocks[this.idx])),e&&(e.cancelBubble=!0,e.preventDefault()),!1}}class p{constructor(e,t,n){this.x=e,this.count=t,this.blocks=n}}const h=25;let g=0,m=0,f="";var b=n(1540);const v={"userscript.js":async function(e){let{addon:t,global:n,console:o,msg:s,safeMsg:r}=e;o.log(r);const i=t.tab.direction,a='\n<div id="s3devHelpPop" class="'.concat(t.tab.scratchClass("modal_modal-overlay"),'" dir="').concat(i,'">\n<div class="').concat(t.tab.scratchClass("modal_modal-content"),'">\n<div class="').concat(t.tab.scratchClass("modal_header"),'">\n  <div class="').concat(t.tab.scratchClass("modal_header-item","modal_header-item-title"),'">').concat(r("help-title"),'</div>\n  <div class="').concat(t.tab.scratchClass("modal_header-item","modal_header-item-close"),'">\n    <div class="').concat(t.tab.scratchClass("close-button_close-button","close-button_large",{others:"close-button"}),'">\n\t  <img class="').concat(t.tab.scratchClass("close-button_close-icon"),'" src="').concat((e=>{if("/icon--close.svg"===e)return"data:image/svg+xml;base64,PHN2ZyBpZD0iTGF5ZXJfMSIgZGF0YS1uYW1lPSJMYXllciAxIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA3LjQ4IDcuNDgiPjxkZWZzPjxzdHlsZT4uY2xzLTF7ZmlsbDpub25lO3N0cm9rZTojZmZmO3N0cm9rZS1saW5lY2FwOnJvdW5kO3N0cm9rZS1saW5lam9pbjpyb3VuZDtzdHJva2Utd2lkdGg6MnB4O308L3N0eWxlPjwvZGVmcz48dGl0bGU+aWNvbi0tYWRkPC90aXRsZT48bGluZSBjbGFzcz0iY2xzLTEiIHgxPSIzLjc0IiB5MT0iNi40OCIgeDI9IjMuNzQiIHkyPSIxIi8+PGxpbmUgY2xhc3M9ImNscy0xIiB4MT0iMSIgeTE9IjMuNzQiIHgyPSI2LjQ4IiB5Mj0iMy43NCIvPjwvc3ZnPg==";throw new Error("Unknown asset: ".concat(e))})("/icon--close.svg"),'">\n\t</div>\n  </div>\n</div>\n<div id="s3devHelpContent">\n<h2><strong>').concat(r("code-tab-features"),'</strong></h2>\n<p dir="auto"><strong>').concat(r("interactive-find-bar"),"</strong> &ndash; ").concat(r("interactive-find-bar-desc"),'</p>\n<p dir="auto"><strong>').concat(r("improved-tidy-up"),"</strong> &ndash; ").concat(r("improved-tidy-up-desc"),'</p>\n<p dir="auto"><strong>').concat(r("help-make-space")," ").concat(r("help-new"),"</strong> &ndash; ").concat(r("help-make-space-desc"),'</p>\n<p dir="auto"><strong>').concat(r("copy-to-clipboard"),"</strong> &ndash; ").concat(r("copy-to-clipboard-desc"),'</p>\n<p dir="auto"><strong>').concat(r("paste-from-clipboard"),"</strong> &ndash; ").concat(r("paste-from-clipboard-desc"),'</p>\n<p dir="auto"><strong>').concat(r("swap-variable"),"</strong> &ndash; ").concat(r("swap-variable-desc"),'</p>\n<p dir="auto"><strong>').concat(r("middleclick"),"</strong> &ndash; ").concat(r("middleclick-desc"),'</p>\n<p dir="auto"><strong>').concat(r("ctrl-lr"),"</strong> &ndash; ").concat(r("ctrl-lr-desc"),'</p>\n<p dir="auto"><strong>').concat(r("ctrl-space"),"</strong> &ndash; ").concat(r("ctrl-space-desc"),"</p>\n<hr />\n<h2><strong>").concat(r("costume-tab-features"),'</strong></h2>\n<p dir="auto"><strong>').concat(r("find-bar"),"</strong> &ndash; ").concat(r("find-bar-costume-desc"),'</p>\n<p dir="auto"><strong>').concat(r("ctrl-lr"),"</strong> &ndash; ").concat(r("ctrl-lr-costume-desc"),"</p>\n<hr />\n<p>").concat(r("youtube"),' -&nbsp;<a target="_blank" href="https://www.youtube.com/griffpatch" rel="noopener noreferrer">https://www.youtube.com/user/griffpatch</a></p>\n</div>\n</div>\n</div>\n');new d(t,s,r,a).init()},"userscript.css":n.n(b).a}},1605:function(e,t,n){"use strict";n.r(t),n.d(t,"resources",(function(){return r}));const o=e=>{if("/decrement.svg"===e)return"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCI+PHBhdGggc3R5bGU9ImZpbGw6IzU3NWU3NTtzdHJva2Utd2lkdGg6LjczNDczNiIgZD0iTTMuMjUgMTEuMzU4aDE3LjUwMXYxLjI4NUgzLjI1eiIvPjwvc3ZnPg==";if("/increment.svg"===e)return"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMjQiIHdpZHRoPSIyNCI+PHBhdGggc3R5bGU9ImZpbGw6IzU3NWU3NTtzdHJva2Utd2lkdGg6LjczNDczNiIgZD0iTTMuMjUgMTEuMzU4aDE3LjUwMXYxLjI4NUgzLjI1eiIvPjxwYXRoIHRyYW5zZm9ybT0icm90YXRlKDkwKSIgc3R5bGU9ImZpbGw6IzU3NWU3NTtzdHJva2Utd2lkdGg6LjczNDczNiIgZD0iTTMuMjUtMTIuNjQyaDE3LjUwMXYxLjI4NUgzLjI1eiIvPjwvc3ZnPg==";if("/settings.svg"===e)return"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCI+PHBhdGggc3R5bGU9Im9wYWNpdHk6Ljc1O2ZpbGw6bm9uZTtzdHJva2U6IzAwMDtzdHJva2Utd2lkdGg6NDtzdHJva2UtbGluZWNhcDpyb3VuZDtzdHJva2UtbGluZWpvaW46cm91bmQ7c3Ryb2tlLW1pdGVybGltaXQ6NDtzdHJva2UtZGFzaGFycmF5Om5vbmU7c3Ryb2tlLW9wYWNpdHk6MSIgZD0iTTU2IDE2djk2IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtMi4zNzYgLTIuMzc2KSBzY2FsZSguMjI0NjIpIi8+PHBhdGggc3R5bGU9Im9wYWNpdHk6LjU7ZmlsbDpub25lO3N0cm9rZTojMDAwO3N0cm9rZS13aWR0aDo0O3N0cm9rZS1saW5lY2FwOnJvdW5kO3N0cm9rZS1saW5lam9pbjptaXRlcjtzdHJva2UtbWl0ZXJsaW1pdDo0O3N0cm9rZS1kYXNoYXJyYXk6bm9uZTtzdHJva2Utb3BhY2l0eToxIiBkPSJNNDAgMzJ2NjQiIHRyYW5zZm9ybT0idHJhbnNsYXRlKC0yLjM3NiAtMi4zNzYpIHNjYWxlKC4yMjQ2MikiLz48cGF0aCBzdHlsZT0ib3BhY2l0eTouMjU7ZmlsbDpub25lO3N0cm9rZTojMDAwO3N0cm9rZS13aWR0aDo0O3N0cm9rZS1saW5lY2FwOnJvdW5kO3N0cm9rZS1saW5lam9pbjptaXRlcjtzdHJva2UtbWl0ZXJsaW1pdDo0O3N0cm9rZS1kYXNoYXJyYXk6bm9uZTtzdHJva2Utb3BhY2l0eToxIiBkPSJNMjQgNDh2MzIiIHRyYW5zZm9ybT0idHJhbnNsYXRlKC0yLjM3NiAtMi4zNzYpIHNjYWxlKC4yMjQ2MikiLz48cGF0aCBzdHlsZT0ib3BhY2l0eTouNzU7ZmlsbDpub25lO3N0cm9rZTojMDAwO3N0cm9rZS13aWR0aDo0O3N0cm9rZS1saW5lY2FwOnJvdW5kO3N0cm9rZS1saW5lam9pbjpyb3VuZDtzdHJva2UtbWl0ZXJsaW1pdDo0O3N0cm9rZS1kYXNoYXJyYXk6bm9uZTtzdHJva2Utb3BhY2l0eToxIiBkPSJNNzIgMTZ2OTYiIHRyYW5zZm9ybT0idHJhbnNsYXRlKC0yLjM3NiAtMi4zNzYpIHNjYWxlKC4yMjQ2MikiLz48cGF0aCBzdHlsZT0ib3BhY2l0eTouNTtmaWxsOm5vbmU7c3Ryb2tlOiMwMDA7c3Ryb2tlLXdpZHRoOjQ7c3Ryb2tlLWxpbmVjYXA6cm91bmQ7c3Ryb2tlLWxpbmVqb2luOm1pdGVyO3N0cm9rZS1taXRlcmxpbWl0OjQ7c3Ryb2tlLWRhc2hhcnJheTpub25lO3N0cm9rZS1vcGFjaXR5OjEiIGQ9Ik04OCAzMnY2NCIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoLTIuMzc2IC0yLjM3Nikgc2NhbGUoLjIyNDYyKSIvPjxwYXRoIHN0eWxlPSJvcGFjaXR5Oi4yNTtmaWxsOm5vbmU7c3Ryb2tlOiMwMDA7c3Ryb2tlLXdpZHRoOjQ7c3Ryb2tlLWxpbmVjYXA6cm91bmQ7c3Ryb2tlLWxpbmVqb2luOm1pdGVyO3N0cm9rZS1taXRlcmxpbWl0OjQ7c3Ryb2tlLWRhc2hhcnJheTpub25lO3N0cm9rZS1vcGFjaXR5OjEiIGQ9Ik0xMDQgNDh2MzIiIHRyYW5zZm9ybT0idHJhbnNsYXRlKC0yLjM3NiAtMi4zNzYpIHNjYWxlKC4yMjQ2MikiLz48L3N2Zz4=";if("/toggle.svg"===e)return"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCI+PGcgc3Ryb2tlLXdpZHRoPSIxLjIiIHN0cm9rZT0iIzAwMTAyNiI+PGcgc3R5bGU9Im9wYWNpdHk6LjU7c3Ryb2tlLXdpZHRoOjQ7c3Ryb2tlLW1pdGVybGltaXQ6MTA7c3Ryb2tlLWRhc2hhcnJheTpub25lIj48cGF0aCBzdHlsZT0ibWl4LWJsZW5kLW1vZGU6bm9ybWFsO2ZpbGw6bm9uZTtmaWxsLXJ1bGU6ZXZlbm9kZDtzdHJva2Utd2lkdGg6NDtzdHJva2UtbWl0ZXJsaW1pdDoxMDtzdHJva2UtZGFzaGFycmF5Om5vbmU7c3Ryb2tlLWRhc2hvZmZzZXQ6MCIgZmlsbD0iI2JmYmZiZiIgZD0iTTY4LjQ1IDMyLjQ1N2MuMy0uMi44LS4xLjkuM2wyLjYgMTAuN3M2LjQgNC43IDguMyA4YzMuMiA1LjUgMy4zIDEwIDMuMyAxMHM3LjEgMi4xIDguMyA3LjhjMS4yIDUuNy0zLjIgMTYuNS0yMiAyMC4yLTE4LjggMy43LTMzLjktMS40LTQxLTEyLjgtNy4xLTExLjQgNC4xLTI1IDMuNS0yNC4ybC0yLjEtMTcuOWMtLjEtLjQuNC0uNy44LS41bDEyLjEgNy45czQuNS0xLjcgOS4yLTEuOWMyLjgtLjIgNS4yIDAgNy41LjR6IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtNC42NTIgLTQuNjUpIHNjYWxlKC4yMzI5KSIvPjxwYXRoIHN0eWxlPSJtaXgtYmxlbmQtbW9kZTpub3JtYWw7ZmlsbDpub25lO2ZpbGwtcnVsZTpldmVub2RkO3N0cm9rZS13aWR0aDo0O3N0cm9rZS1taXRlcmxpbWl0OjEwO3N0cm9rZS1kYXNoYXJyYXk6bm9uZTtzdHJva2UtZGFzaG9mZnNldDowIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBzdHJva2UtbGluZWNhcD0icm91bmQiIGZpbGw9Im5vbmUiIGQ9Ik0xMDEuNjUgNjIuOTU3Yy00LjcgMy44LTExLjkgMy45LTExLjkgMy45bTEwLjYgNy4zYy02LjMuNS0xMC4yLTEuNC0xMC4yLTEuNG0tNjguOC0xMC4xczguNiAyLjggMTIuMSA1LjltLjMgMy41Yy00LjMgMS43LTExLjcuNi0xMS43LjYiIHRyYW5zZm9ybT0idHJhbnNsYXRlKC00LjY1MiAtNC42NSkgc2NhbGUoLjIzMjkpIi8+PC9nPjxnIHN0eWxlPSJvcGFjaXR5Oi43NTtzdHJva2Utd2lkdGg6NDtzdHJva2UtbWl0ZXJsaW1pdDoxMDtzdHJva2UtZGFzaGFycmF5Om5vbmUiPjxwYXRoIHN0eWxlPSJtaXgtYmxlbmQtbW9kZTpub3JtYWw7ZmlsbDpub25lO2ZpbGwtcnVsZTpldmVub2RkO3N0cm9rZS13aWR0aDo0O3N0cm9rZS1taXRlcmxpbWl0OjEwO3N0cm9rZS1kYXNoYXJyYXk6bm9uZTtzdHJva2UtZGFzaG9mZnNldDowIiBmaWxsPSIjYmZiZmJmIiBkPSJNNjguNDUgMzIuNDU3Yy4zLS4yLjgtLjEuOS4zbDIuNiAxMC43czYuNCA0LjcgOC4zIDhjMy4yIDUuNSAzLjMgMTAgMy4zIDEwczcuMSAyLjEgOC4zIDcuOGMxLjIgNS43LTMuMiAxNi41LTIyIDIwLjItMTguOCAzLjctMzMuOS0xLjQtNDEtMTIuOC03LjEtMTEuNCA0LjEtMjUgMy41LTI0LjJsLTIuMS0xNy45Yy0uMS0uNC40LS43LjgtLjVsMTIuMSA3LjlzNC41LTEuNyA5LjItMS45YzIuOC0uMiA1LjIgMCA3LjUuNHoiIHRyYW5zZm9ybT0idHJhbnNsYXRlKC0yLjMyMyAtMi4zMjEpIHNjYWxlKC4yMzI5KSIvPjxwYXRoIHN0eWxlPSJtaXgtYmxlbmQtbW9kZTpub3JtYWw7ZmlsbDpub25lO2ZpbGwtcnVsZTpldmVub2RkO3N0cm9rZS13aWR0aDo0O3N0cm9rZS1taXRlcmxpbWl0OjEwO3N0cm9rZS1kYXNoYXJyYXk6bm9uZTtzdHJva2UtZGFzaG9mZnNldDowIiBzdHJva2UtbGluZWpvaW49InJvdW5kIiBzdHJva2UtbGluZWNhcD0icm91bmQiIGZpbGw9Im5vbmUiIGQ9Ik0xMDEuNjUgNjIuOTU3Yy00LjcgMy44LTExLjkgMy45LTExLjkgMy45bTEwLjYgNy4zYy02LjMuNS0xMC4yLTEuNC0xMC4yLTEuNG0tNjguOC0xMC4xczguNiAyLjggMTIuMSA1LjltLjMgMy41Yy00LjMgMS43LTExLjcuNi0xMS43LjYiIHRyYW5zZm9ybT0idHJhbnNsYXRlKC0yLjMyMyAtMi4zMjEpIHNjYWxlKC4yMzI5KSIvPjwvZz48ZyBzdHlsZT0ic3Ryb2tlLXdpZHRoOjQ7c3Ryb2tlLW1pdGVybGltaXQ6MTA7c3Ryb2tlLWRhc2hhcnJheTpub25lIj48cGF0aCBzdHlsZT0ibWl4LWJsZW5kLW1vZGU6bm9ybWFsO2ZpbGw6I2ZmZjtmaWxsLW9wYWNpdHk6MTtmaWxsLXJ1bGU6ZXZlbm9kZDtzdHJva2Utd2lkdGg6NDtzdHJva2UtbWl0ZXJsaW1pdDoxMDtzdHJva2UtZGFzaGFycmF5Om5vbmU7c3Ryb2tlLWRhc2hvZmZzZXQ6MCIgZmlsbD0iI2JmYmZiZiIgZD0iTTczLjQ1IDM3LjQ1N2MuMy0uMi44LS4xLjkuM2wyLjYgMTAuN3M2LjQgNC43IDguMyA4YzMuMiA1LjUgMy4zIDEwIDMuMyAxMHM3LjEgMi4xIDguMyA3LjhjMS4yIDUuNy0zLjIgMTYuNS0yMiAyMC4yLTE4LjggMy43LTMzLjktMS40LTQxLTEyLjgtNy4xLTExLjQgNC4xLTI1IDMuNS0yNC4ybC0yLjEtMTcuOWMtLjEtLjQuNC0uNy44LS41bDEyLjEgNy45czQuNS0xLjcgOS4yLTEuOWMyLjgtLjIgNS4yIDAgNy41LjR6IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtMS4xNTkgLTEuMTU3KSBzY2FsZSguMjMyOSkiLz48cGF0aCBzdHlsZT0ibWl4LWJsZW5kLW1vZGU6bm9ybWFsO2ZpbGw6bm9uZTtmaWxsLXJ1bGU6ZXZlbm9kZDtzdHJva2Utd2lkdGg6NDtzdHJva2UtbWl0ZXJsaW1pdDoxMDtzdHJva2UtZGFzaGFycmF5Om5vbmU7c3Ryb2tlLWRhc2hvZmZzZXQ6MCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIgc3Ryb2tlLWxpbmVjYXA9InJvdW5kIiBmaWxsPSJub25lIiBkPSJNMTA2LjY1IDY3Ljk1N2MtNC43IDMuOC0xMS45IDMuOS0xMS45IDMuOW0xMC42IDcuM2MtNi4zLjUtMTAuMi0xLjQtMTAuMi0xLjRtLTY4LjgtMTAuMXM4LjYgMi44IDEyLjEgNS45bS4zIDMuNWMtNC4zIDEuNy0xMS43LjYtMTEuNy42IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgtMS4xNTkgLTEuMTU3KSBzY2FsZSguMjMyOSkiLz48L2c+PC9nPjwvc3ZnPg==";throw new Error("Unknown asset: ".concat(e))};var s=n(1566);const r={"userscript.js":async function(e){let{addon:t,global:n,console:s,msg:r}=e;const i=await t.tab.traps.getPaper(),a=await t.tab.waitForElement("[class^='paint-editor_canvas-container']");try{if(!("colorIndex"in t.tab.redux.state.scratchPaint.fillMode))return void s.error("Detected new paint editor; this will be supported in future versions.")}catch(e){}const l=a[t.tab.traps.getInternalKey(a)].child.child.child.stateNode,c=[],d=e=>{const t=e.substr(1),n=parseInt(t,16);return[n>>16&255,n>>8&255,255&n]},u={enabled:t.settings.get("default")&&!t.self.disabled,previous:+t.settings.get("previous"),next:+t.settings.get("next"),opacity:+t.settings.get("opacity"),opacityStep:+t.settings.get("opacityStep"),layering:t.settings.get("layering"),mode:t.settings.get("mode"),beforeTint:d(t.settings.get("beforeTint")),afterTint:d(t.settings.get("afterTint"))},p=()=>i.project.layers.find(e=>e.data.isBackgroundGuideLayer).children[0].position;let h=0;const g=()=>++h,m=()=>{g();const e=i.project;if(!e)return;c.length=0;const t=e.layers;for(let e=t.length-1;e>=0;e--){const n=t[e];n.data.sa_isOnionLayer&&n.remove()}},f=()=>{const e=i.project;if(!e)return;const t=e.layers.find(e=>e.data.sa_isOnionLayer);if(t)if("front"===u.layering)e.addLayer(t);else{0===e.layers.find(e=>e.data.isRasterLayer).index?e.insertLayer(0,t):e.insertLayer(1,t)}},b=(e,t)=>{if(e.children)for(const n of e.children)b(n,t);t(e)},v=(e,t,n,o)=>{const s=o?u.beforeTint:u.afterTint,r=(e+t+n)/3/255/1.5+(1-1/1.5);return[s[0]*r,s[1]*r,s[2]*r]},y=(e,t)=>(e=>{let[t,n,o]=e;const s=Math.round(t).toString(16).padStart(2,"0"),r=Math.round(n).toString(16).padStart(2,"0"),i=Math.round(o).toString(16).padStart(2,"0");return"#".concat(s).concat(r).concat(i)})(v(255*e.red,255*e.green,255*e.blue,t)),k=(e,t)=>{const{width:n,height:o}=e.canvas,s=e.context,r=s.getImageData(0,0,n,o),i=r.data;for(let e=0;e<i.length;e+=4){const n=i[e+0],o=i[e+1],s=i[e+2];if(0===i[e+3])continue;const r=v(n,o,s,t);i[e+0]=r[0],i[e+1]=r[1],i[e+2]=r[2]}s.putImageData(r,0,0)},x=e=>{const t=e.strokeBounds,{width:n,height:o}=t,s=Math.min(3e3/n,3e3/o),r=new i.Raster(new i.Size(n,o));r.remove(),r.smoothing=!0,r.guide=!0,r.locked=!0;let a=0;const l=r.draw;return r.draw=function(){const r=this.getView().getZoom()*window.devicePixelRatio,c=Math.max(1,Math.min(s,2**Math.ceil(Math.log2(r))));if(c>a){a=c;const s=this.canvas,r=this.context,l=n*c,d=o*c;s.width=l,s.height=d,this._size=new i.Size(l,d);const u=t.getTopLeft(),p=t.getBottomRight(),h=new i.Size(p.subtract(u)),g=(new i.Matrix).scale(c).translate(u.negate());r.save(),g.applyToContext(r),e.draw(r,new i.Base({matrices:[g]})),r.restore(),this.matrix.reset(),this.transform((new i.Matrix).translate(u.add(h.divide(2))).scale(1/c))}for(var d=arguments.length,u=new Array(d),p=0;p<d;p++)u[p]=arguments[p];return l.call(this,...u)},r},w=(e,t,n,o)=>new Promise((s,r)=>{const{rotationCenterX:a,rotationCenterY:l}=t,c=(n=(n=n.split(/<\s*svg:/).join("<")).split(/<\/\s*svg:/).join("</")).match(/<svg [^>]*>/);c&&-1===c[0].indexOf("xmlns=")&&(n=n.replace("<svg ",'<svg xmlns="http://www.w3.org/2000/svg" '));const d=(new DOMParser).parseFromString(n,"text/xml"),h=d.documentElement.attributes.viewBox?d.documentElement.attributes.viewBox.value.match(/\S+/g):null;if(h)for(let e=0;e<h.length;e++)h[e]=parseFloat(h[e]);i.project.importSVG(n,{expandShapes:!0,insert:!1,onLoad:t=>{t?s((e=>{const t=[];return b(e,e=>{e instanceof i.Raster&&t.push(new Promise((t,n)=>{e.on("load",()=>t()),e.on("error",()=>n(new Error("Raster inside SVG failed to load")))}))}),Promise.all(t)})(t).then(()=>(t=>{if(t.opacity=e,b(t,e=>{"PathItem"===e.className&&(e.clockwise=!0),"PointText"===e.className||e.children||e.strokeWidth&&(e.strokeWidth=2*e.strokeWidth),e.locked=!0,e.guide=!0}),t.scale(2,new i.Point(0,0)),"tint"===u.mode){const e=new Set;b(t,t=>{if(t.strokeColor&&(t.strokeColor=y(t.strokeColor,o)),t.fillColor){const n=t.fillColor.gradient;if(n){if(e.has(n))return;e.add(n);for(const e of n.stops)e.color=y(e.color,o)}else t.fillColor=y(t.fillColor,o)}t.canvas&&k(t,o)})}const n=p();if(void 0!==a&&void 0!==l){let e=new i.Point(a,l);h&&h.length>=2&&!isNaN(h[0])&&!isNaN(h[1])&&(e=e.subtract(h[0],h[1])),t.translate(n.subtract(e.multiply(2)))}else t.translate(n.subtract(t.bounds.width,t.bounds.height));return x(t)})(t))):r(new Error("could not load onion skin"))}})}),I=async()=>{const e=i.project;if(!e)return;const n=(()=>{const e=document.querySelector("[class*='selector_list-item'][class*='sprite-selector-item_is-selected']");if(!e)return-1;const t=e.querySelector("[class*='sprite-selector-item_number']");return t?+t.textContent-1:-1})();if(-1===n)return;m();const o=g(),r=t.tab.traps.vm;if(!r)return;const a=e.activeLayer,l=r.editingTarget.sprite.costumes,c=Math.max(0,n-u.previous),d=Math.min(l.length-1,n+u.next);try{const e=[];for(let t=c;t<=d;t++){if(t===n)continue;const o=t<n,s=Math.abs(t-n)-1,r=(u.opacity-u.opacityStep*s)/100;r<=0||e.push({index:t,isBefore:o,opacity:r})}const t=await Promise.all(e.map(e=>{let{index:t,isBefore:n,opacity:o}=e;const s=l[t],a=r.getCostume(t);if("svg"===s.dataFormat)return w(o,s,a,n);if("png"===s.dataFormat||"jpg"===s.dataFormat)return((e,t,n,o)=>new Promise((s,r)=>{let{rotationCenterX:a,rotationCenterY:l}=t;const c=new Image;c.onload=()=>{const t=p(),n=Math.min(2*t.x,c.width),r=Math.min(2*t.y,c.height);void 0===a&&(a=n/2),void 0===l&&(l=r/2);const d=new i.Raster(c);d.opacity=e,d.guide=!0,d.locked=!0;const h=n/2+(t.x-a),g=r/2+(t.y-l);d.position=new i.Point(h,g),d.remove(),"tint"===u.mode&&k(d,o),s(d)},c.onerror=()=>{r(new Error("could not load image"))},c.src=n}))(o,s,a,n);throw new Error("Unknown data format: ".concat(s.dataFormat))}));if(h===o){const e=(()=>{const e=new i.Layer;return e.locked=!0,e.guide=!0,e.data.sa_isOnionLayer=!0,e})();for(const n of t)e.addChild(n);f()}}catch(e){s.error(e)}a.activate()},_=e=>{u.enabled!==e&&(u.enabled=e,u.enabled?(0===u.next&&0===u.previous&&(u.previous=1,O.previous.value=u.previous),0===u.opacity&&(u.opacity=25,O.opacity.value=u.opacity),I()):m(),S.dataset.enabled=u.enabled)},D=e=>{0===u.previous&&0===u.next||0===u.opacity?_(!1):u.enabled?e?f():I():(u.previous>0||u.next>0)&&_(!0)},C=()=>{const e=document.createElement("div");return e.className="sa-onion-group",e},T=function(){let{useButtonTag:e}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const t=document.createElement(e?"button":"span");return t.className="sa-onion-button",t.setAttribute("role","button"),t},L=e=>{const t=document.createElement("img");return t.className="sa-onion-image",t.draggable=!1,t.dataset.image=e,t.loading="lazy",t.src=o("/"+e+".svg"),t},N=document.createElement("div");N.className="sa-onion-controls-container",N.dir="";const M=C();t.tab.displayNoneWhileDisabled(M,{display:"flex"});const S=T();S.dataset.enabled=u.enabled,S.addEventListener("click",()=>_(!u.enabled)),S.title=r("toggle"),S.appendChild(L("toggle")),M.appendChild(S);const E=T();E.addEventListener("click",()=>B(!j())),E.title=r("settings"),E.appendChild(L("settings")),M.appendChild(E),N.appendChild(M);const A=document.createElement("div");A.className="sa-onion-settings";const B=e=>{E.dataset.enabled=e,A.dataset.visible=e},j=()=>"true"===A.dataset.visible,O={};for(const e of["previous","next","opacity","opacityStep"]){const t=document.createElement("label");t.className="sa-onion-settings-line";const n=document.createElement("div");n.className="sa-onion-settings-label",n.textContent=r(e),t.appendChild(n);const o=C(),s=T(),i=document.createElement("div");i.style.width="20px",s.appendChild(i);const a=document.createElement("input");O[e]=a,a.className="sa-onion-settings-input",a.type="number",a.step="1",a.min="0",a.max="100",a.value=u[e],a.addEventListener("input",t=>{if(0===a.value.length)return u[e]=0,void D();let n=+a.value;n>+a.max?n=+a.max:n<0&&(n=0),a.value=n,u[e]=n,D()}),a.addEventListener("blur",()=>{a.value||(a.value="0")}),s.appendChild(a);const l=T();l.appendChild(L("decrement")),l.addEventListener("click",()=>{u[e]>0&&(u[e]--,a.value=u[e],D())});const c=T();c.appendChild(L("increment")),c.addEventListener("click",()=>{u[e]<+a.max&&(u[e]++,a.value=u[e],D())}),o.appendChild(l),o.appendChild(s),o.appendChild(c),t.appendChild(o),A.appendChild(t)}const R=document.createElement("div");R.className="sa-onion-settings-line";const z=document.createElement("div");z.className="sa-onion-settings-label",z.textContent=r("mode");const H=C();R.appendChild(z);const Z=T({useButtonTag:!0});Z.appendChild(document.createTextNode(r("merge"))),H.appendChild(Z),Z.addEventListener("click",e=>{u.mode="merge",W.dataset.enabled=!1,Z.dataset.enabled=!0,D()}),Z.dataset.enabled="merge"===u.mode;const W=T({useButtonTag:!0});W.appendChild(document.createTextNode(r("tint"))),H.appendChild(W),W.addEventListener("click",e=>{u.mode="tint",W.dataset.enabled=!0,Z.dataset.enabled=!1,D()}),W.dataset.enabled="tint"===u.mode,R.appendChild(H),A.appendChild(R);const P=document.createElement("div");P.className="sa-onion-settings-line";const U=document.createElement("div");U.className="sa-onion-settings-label",U.textContent=r("layering");const G=C();P.appendChild(U);const Y=T({useButtonTag:!0});Y.appendChild(document.createTextNode(r("front"))),G.appendChild(Y),Y.addEventListener("click",e=>{u.layering="front",F.dataset.enabled=!1,Y.dataset.enabled=!0,D(!0)}),Y.dataset.enabled="front"===u.layering;const F=T({useButtonTag:!0});F.appendChild(document.createTextNode(r("behind"))),G.appendChild(F),F.addEventListener("click",e=>{u.layering="behind",F.dataset.enabled=!0,Y.dataset.enabled=!1,D(!0)}),F.dataset.enabled="behind"===u.layering,P.appendChild(G),A.appendChild(P);const V="http://www.w3.org/2000/svg",X=document.createElementNS(V,"svg");X.setAttribute("class","sa-onion-settings-tip"),X.setAttribute("width","14"),X.setAttribute("height","7");const J=document.createElementNS(V,"polygon");J.setAttribute("class","sa-onion-settings-polygon"),J.setAttribute("points","0,0 7,7, 14,0"),X.appendChild(J),A.appendChild(X);let K=null;t.self.addEventListener("disabled",()=>{B(!1),K=u.enabled,_(!1)}),t.self.addEventListener("reenabled",()=>{_(K)});(()=>{const e=i.Project.prototype.addLayer;i.Project.prototype.addLayer=function(t){const n=e.call(this,t);if(t.data.isBackgroundGuideLayer){let t;for(;t=c.shift();)e.call(this,t);f()}return n};const t=i.Project.prototype.importJSON;i.Project.prototype.importJSON=function(e){const n=t.call(this,e);return u.enabled&&I(),n};const n=i.Layer.prototype.remove;i.Layer.prototype.remove=function(){if(this.data.isBackgroundGuideLayer){for(const e of i.project.layers)e.data.sa_isOnionLayer&&c.push(e);for(const e of c)e.remove()}return n.call(this)}})(),(()=>{let e=!1;const t=l.constructor,n=t.prototype.importImage;t.prototype.importImage=function(){e=!0,m();for(var t=arguments.length,o=new Array(t),s=0;s<t;s++)o[s]=arguments[s];return n.call(this,...o)};const o=t.prototype.recalibrateSize;t.prototype.recalibrateSize=function(t){return o.call(this,()=>{t&&t(),e&&(e=!1,u.enabled&&I())})},l.recalibrateSize=t.prototype.recalibrateSize.bind(l),l.importImage=t.prototype.importImage.bind(l)})(),(async()=>{let e=!1;for(;;){const n=await t.tab.waitForElement("[class^='paint-editor_canvas-controls']",{markAsSeen:!0,reduxEvents:["scratch-gui/navigation/ACTIVATE_TAB","scratch-gui/mode/SET_PLAYER"],reduxCondition:e=>1===e.scratchGui.editorTab.activeTabIndex&&!e.scratchGui.mode.isPlayerOnly}),o=n.querySelector("[class^='paint-editor_zoom-controls']"),s=document.querySelector("[class^='paint-editor_canvas-container']"),r=N.querySelector("[class^='paint-editor_zoom-controls']");if(r&&r.parentNode.removeChild(r),N.appendChild(o),n.appendChild(N),s.appendChild(A),!e){e=!0;const t=o.firstChild.className,n=o.firstChild.firstChild.className,s=o.firstChild.firstChild.firstChild.className;for(const e of document.querySelectorAll(".sa-onion-group"))e.className+=" "+t;for(const e of document.querySelectorAll(".sa-onion-button"))e.className+=" "+n;for(const e of document.querySelectorAll(".sa-onion-image"))e.className+=" "+s}u.enabled&&I()}})()},"style.css":n.n(s).a}},1611:function(e,t,n){"use strict";n.r(t),n.d(t,"resources",(function(){return l}));var o=n(1501),s=n(1502),r=n(1503),i=async e=>{let{addon:t,console:n,msg:i}=e;const a=new s.a(250),l=(e,n)=>{if(e=Object(o.b)(e),!t.tab.redux.state||!t.tab.redux.state.scratchGui)return;const s=e=>{let{detail:n}=e;"scratch-gui/color-picker/DEACTIVATE_COLOR_PICKER"===n.action.type&&(t.tab.redux.removeEventListener("statechanged",s),setTimeout(()=>{document.body.classList.remove("sa-hide-eye-dropper-background")},50))},r=n=>{let{detail:o}=n;"scratch-gui/color-picker/ACTIVATE_COLOR_PICKER"===o.action.type&&(t.tab.redux.removeEventListener("statechanged",r),t.tab.redux.addEventListener("statechanged",s),setTimeout(()=>{t.tab.redux.dispatch({type:"scratch-gui/color-picker/DEACTIVATE_COLOR_PICKER",color:e})},50))};t.tab.redux.addEventListener("statechanged",r),document.body.classList.add("sa-hide-eye-dropper-background"),n.click()},c=()=>{const e=document.querySelector("button.scratchEyedropper");a.abort(!1),t.tab.redux.initialize();const n=(e=>{const{children:t}=e.parentElement,n=t[1].getAttribute("aria-valuenow"),o=t[3].getAttribute("aria-valuenow"),s=t[5].getAttribute("aria-valuenow"),i=Number(s)/255;return Object(r.a)("hsv(".concat(n,", ").concat(o,", ").concat(i||0,")")).toHexString()})(e),s=Object.assign(document.createElement("div"),{className:"sa-color-picker sa-color-picker-code"});t.tab.displayNoneWhileDisabled(s,{display:"flex"});const c=Object.assign(document.createElement("input"),{className:"sa-color-picker-color sa-color-picker-code-color",type:"color",value:n||"#000000"}),d=Object.assign(document.createElement("input"),{className:t.tab.scratchClass("input_input-form",{others:"sa-color-picker-text sa-color-picker-code-text"}),type:"text",pattern:"^#?([0-9a-fA-F]{3}){1,2}$",placeholder:i("hex"),value:n||""});c.addEventListener("input",()=>a.limit(()=>l(d.value=c.value,e))),d.addEventListener("change",()=>{const{value:t}=d;Object(o.a)().test(t)&&l(c.value=Object(o.b)(t),e)}),s.appendChild(c),s.appendChild(d),e.parentElement.insertBefore(s,e)},d=await t.tab.traps.getBlockly(),u=d.FieldColourSlider.prototype.showEditor_;d.FieldColourSlider.prototype.showEditor_=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const o=u.call(this,...t);return c(),o}},a=n(1565);const l={"userscript.js":async e=>{i(e)},"style.css":n.n(a).a}},1614:function(e,t,n){"use strict";n.r(t),n.d(t,"resources",(function(){return a}));function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var i=n(1581);const a={"userscript.js":async function(e){let{addon:t,global:n,console:o,msg:r}=e;let i,a,l,c,d,u;const p=e=>{const t=e.indexOf("//");return-1===t||0===t?null:e.substr(0,t)},h=e=>{const t=e.indexOf("//");return-1===t||0===t?e:e.substr(t+"//".length)},g=(e,t)=>{const n=h(e);return t?"".concat(t).concat("//").concat(n):n},m=e=>!e.includes("//")&&!e.endsWith("/"),f=["_mouse_","_stage_","_edge_","_myself_","_random_"],b=e=>""===e?"2":f.includes(e)?"".concat(e,"2"):e,v=e=>{const t=e.closest("[class*='sprite-selector_sprite-selector']");if(t)return t[a].child.sibling.child.stateNode;const n=e.closest('[class*="asset-panel_wrapper"]');if(n)return n[a].child.child.stateNode;throw new Error("cannot find SortableHOC")},y=(e,t,n)=>Math.min(Math.max(e,t),n),k=e=>e&&e.name&&"object"==typeof e.name?e.name:null,x={assetId:"&__sa_folders_folder",encodeDataURI:()=>(e=>{if("/folder.svg"===e)return"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIGhlaWdodD0iMjQiIHdpZHRoPSIyNCI+PHBhdGggZD0iTTAgMGgyNHYyNEgweiIgZmlsbD0ibm9uZSIvPjxwYXRoIGQ9Ik0xMCA0SDRjLTEuMSAwLTEuOTkuOS0xLjk5IDJMMiAxOGMwIDEuMS45IDIgMiAyaDE2YzEuMSAwIDItLjkgMi0yVjhjMC0xLjEtLjktMi0yLTJoLThsLTItMnoiLz48L3N2Zz4=";throw new Error("Unknown asset: ".concat(e))})("/folder.svg")},w="data:image/svg+xml;base64,".concat(btoa('<?xml version="1.0" encoding="UTF-8"?>\n<svg width="100px" height="100px" viewBox="0 0 20 20" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n    <g id="Sound" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">\n        <path d="M12.4785058,12.6666667 C12.3144947,12.6666667 12.1458852,12.6272044 11.9926038,12.5440517 C11.537358,12.2960031 11.3856094,11.7562156 11.6553847,11.3376335 C12.1688774,10.5371131 12.1688774,9.54491867 11.6553847,8.74580756 C11.3856094,8.32581618 11.537358,7.78602861 11.9926038,7.53798001 C12.452448,7.29275014 13.0379829,7.43086811 13.3046926,7.84804076 C14.1737981,9.20103311 14.1737981,10.8809986 13.3046926,12.233991 C13.1268862,12.5130457 12.806528,12.6666667 12.4785058,12.6666667 Z M15.3806784,13.8333333 C15.2408902,13.8333333 15.0958763,13.796281 14.9665396,13.7182064 C14.5785295,13.485306 14.4491928,12.9784829 14.6791247,12.5854634 C15.5949331,11.0160321 15.5949331,9.065491 14.6791247,7.49738299 C14.4491928,7.10436352 14.5785295,6.59621712 14.9665396,6.36331669 C15.3558562,6.13438616 15.8549129,6.26274605 16.0848448,6.65444223 C17.3050517,8.74260632 17.3050517,11.3389168 16.0848448,13.4270809 C15.9319924,13.6890939 15.6602547,13.8333333 15.3806784,13.8333333 Z M10.3043478,5.62501557 L10.3043478,13.873675 C10.3043478,14.850934 9.10969849,15.3625101 8.36478311,14.7038052 L6.7566013,13.2797607 C6.18712394,12.7762834 5.44499329,12.4968737 4.67362297,12.4968737 L4.3923652,12.4968737 C3.62377961,12.4968737 3,11.8935108 3,11.1470686 L3,8.36646989 C3,7.62137743 3.62377961,7.01666471 4.3923652,7.01666471 L4.65830695,7.01666471 C5.42967727,7.01666471 6.17180792,6.73725504 6.74128529,6.23377771 L8.36478311,4.79623519 C9.10969849,4.13753026 10.3043478,4.64910643 10.3043478,5.62501557 Z" id="Combined-Shape" fill="#575E75"></path>\n    </g>\n</svg>'));let I=null;const _=Object.create(null),D=e=>{const t=e=>{const t=(e=>{let t=0;for(let n=0;n<e.length;n++)t=31*t+e.charCodeAt(n),t|=0;return t})(e),n=(o=t,function(){var e=o+=1831565813;return e=Math.imul(e^e>>>15,1|e),(((e^=e+Math.imul(e^e>>>7,61|e))^e>>>14)>>>0)/4294967296});var o;return n(),n(),n(),n(),n()};if(!_[e]){I||(I=document.createElement("style"),document.head.appendChild(I));const n=360*t(e),o="hsla(".concat(n,"deg, 100%, 85%, 0.5)"),s=Object.keys(_).length,r="sa-folders-color-".concat(s);_[e]=r,I.textContent+=".".concat(r,"{background-color:").concat(o," !important;}"),I.textContent+=".".concat(r,'[class*="sprite-selector_raised"]:not([class*="sa-folders-folder"]){background-color:hsla(').concat(n,"deg, 100%, 77%, 1) !important;}")}return _[e]},C=e=>{const t=Object.create(null),n=[];for(const o of e){const e=o.getName?o.getName():o.name,s=p(e);"string"==typeof s?(t[s]||(t[s]=[],n.push(t[s])),t[s].push(o)):n.push(o)}const o=n.flat();for(let t=0;t<e.length;t++)if(n[t]!==e[t])return{items:o,changed:!0};return{items:o,changed:!1}},T=()=>{const{items:e,changed:t}=C(i.runtime.targets);t&&(i.runtime.targets=e,i.emitTargetsUpdate())},L=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:i.editingTarget;const{items:t,changed:n}=C(e.sprite.costumes);n&&(e.sprite.costumes=t,i.emitTargetsUpdate())},N=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:i.editingTarget;const{items:t,changed:n}=C(e.sprite.sounds);n&&(e.sprite.sounds=t,i.emitTargetsUpdate())},M=e=>{const t=e.constructor;if(!Array.isArray(e.props.items)||"string"!=typeof e.props.selectedId&&"number"!=typeof e.props.selectedItemIndex||void 0===e.containerBox||void 0!==t.prototype.componentDidMount||void 0!==t.prototype.componentDidUpdate||"function"!=typeof t.prototype.handleAddSortable||"function"!=typeof t.prototype.handleRemoveSortable||"function"!=typeof t.prototype.setRef)throw new Error("Can not comprehend SortableHOC")};class S{constructor(){this.cache=new Map,this.usedThisTick=new Set}has(e){return this.cache.has(e)}get(e){return this.usedThisTick.add(e),this.cache.get(e)}set(e,t){this.usedThisTick.add(e),this.cache.set(e,t)}startTick(){this.usedThisTick.clear()}endTick(){for(const e of Array.from(this.cache.keys()))this.usedThisTick.has(e)||this.cache.delete(e)}clear(){this.usedThisTick.clear(),this.cache.clear()}}const E=(e,t)=>{const n=new S,o=new S,r=new S,i=[[0,0],[40,0],[0,40],[40,40]],a=e=>{let t='data:image/svg+xml;,<svg xmlns="http://www.w3.org/2000/svg" width="'.concat(80,'" height="').concat(80,'">');for(let n=0;n<Math.min(i.length,e.length);n++){const o=e[n],s=40,r=40,[a,l]=i[n];let c;o.asset?c=o.asset.encodeDataURI():o.costume&&o.costume.asset?c=o.costume.asset.encodeDataURI():o.url&&(c=w),c&&(t+='<image width="'.concat(s,'" height="').concat(r,'" x="').concat(a,'" y="').concat(l,'" href="').concat(c,'"/>'))}return t+="</svg>",t},h=e=>{let t="sa_folder&&";for(let n=0;n<Math.min(i.length,e.length);n++){const o=e[n];o.asset?t+=o.asset.assetId:o.costume&&o.costume.asset?t+=o.costume.asset.assetId:o.url&&(t+=o.url),t+="&&"}return t},g=e=>{if(1===t){return e.props.items.find(t=>t.id===e.props.selectedId)}if(2===t){return e.props.items[e.props.selectedItemIndex]}return null};e.prototype.saInitialSetup=function(){n.clear(),o.clear(),r.clear();const e=[],s=g(this);if(s&&!s.isStage){const n=p(s.name);e.push(n),1===t?l=n:2===t&&(c=n)}this.setState({folders:e})},e.prototype.componentDidMount=function(){const e=g(this);if(e){const n=p(e.name);1===t?l=n:2===t&&(c=n)}this.saInitialSetup()},e.prototype.componentDidUpdate=function(e,n){const o=g(this);if(o){const n=p(o.name),s=this.state.folders.includes(n)?n:null;let r;1===t?l=s:2===t&&(c=s),r=this.props.selectedId?this.props.selectedId!==e.selectedId:this.props.items[this.props.selectedItemIndex]&&e.items[e.selectedItemIndex]&&this.props.items[this.props.selectedItemIndex].name!==e.items[e.selectedItemIndex].name,r&&(o.isStage||"string"!=typeof n||this.state.folders.includes(n)||this.setState(e=>({folders:[...e.folders,n]})))}};const m=e.prototype.render;e.prototype.render=function(){const e=this.props;this.props=s(s({},this.props),((e,s)=>{const i=e=>{const t=e.name;let o,s;n.has(t)?(o=n.get(t),s=o.name):(s={toString:()=>"_".concat(e.name)},o={},n.set(t,o));const r=p(e.name);return Object.assign(o,e),s.realName=e.name,s.realIndex=u,s.inFolder=r,o.name=s,{newItem:o,itemData:s}};n.startTick(),o.startTick(),r.startTick();const l=new Map,c=[],d={items:c};let u=0;for(;u<s.items.length;){const n=s.items[u],g=p(n.name);if(null===g){if(c.push(i(n).newItem),2===t){s.selectedItemIndex===u&&(d.selectedItemIndex=c.length-1)}}else{const n=-1!==e.indexOf(g),m=[];for(;u<s.items.length;){const e=s.items[u],o=i(e);if(p(e.name)!==g)break;if(m.push(o.newItem),2===t){s.selectedItemIndex===u&&(d.selectedItemIndex=n?c.length+m.length:-1)}u++}u--;const f=l.get(g)||0;l.set(g,f+1);const b=h(m),v="".concat(n,"&").concat(f,"&").concat(g,"&").concat(b,"&"),y="&__".concat(f,"_").concat(g),k=b;let w,I,_;if(o.has(v)?(w=o.get(v),I=w.name):(w={id:{toString:()=>y}},I={toString:()=>y},o.set(v,w)),I.folder=g,I.folderOpen=n,w.items=m,w.name=I,n?_=x:r.has(k)?_=r.get(k):(_={assetId:k,encodeDataURI:()=>a(m)},r.set(k,_)),1===t?(w.costume||(w.costume={}),w.costume.asset=_,w.id||(w.id={}),w.id.sa_folder_items=m,w.id.toString=()=>y):(w.asset=_,w.dragPayload||(w.dragPayload={}),w.dragPayload.sa_folder_items=m),c.push(w),n)for(const e of m)c.push(e)}u++}return n.endTick(),o.endTick(),r.endTick(),d})(this.state&&this.state.folders||[],this.props)),1===t?d=this.props.items:2===t&&(u=this.props.items);const i=m.call(this);return this.props=e,i}},A=(e,t)=>{const n=v(e.ref);return(n.state&&n.state.folders||[]).includes(t)},B=(e,t,n)=>{v(e.ref).setState(e=>{let o=e&&e.folders||[];return o=o.filter(e=>e!==t),n?{folders:[...o,t]}:{folders:o}})};t.tab.createEditorContextMenu((e,n)=>{if("sprite"!==e&&"costume"!==e&&"sound"!==e)return;const o=n.target[t.tab.traps.getInternalKey(n.target)].return.return.return.stateNode,s=k(o.props);if(s){if("string"==typeof s.folder){n.target.setAttribute("sa-folders-context-type","folder");const e=e=>{const t=A(o,s.folder);if(B(o,s.folder,!1),t&&"string"==typeof e&&B(o,e,!0),"SPRITE"===o.props.dragType){for(const t of i.runtime.targets)t.isOriginal&&p(t.getName())===s.folder&&i.renameSprite(t.id,b(g(t.getName(),e)));i.emitWorkspaceUpdate(),T()}else if("COSTUME"===o.props.dragType){for(let t=0;t<i.editingTarget.sprite.costumes.length;t++){const n=i.editingTarget.sprite.costumes[t];p(n.name)===s.folder&&i.renameCostume(t,g(n.name,e))}L()}else if("SOUND"===o.props.dragType){for(let t=0;t<i.editingTarget.sprite.sounds.length;t++){const n=i.editingTarget.sprite.sounds[t];p(n.name)===s.folder&&i.renameSound(t,g(n.name,e))}N()}},a=async()=>{let n=await t.tab.prompt(r("rename-folder-prompt-title"),r("rename-folder-prompt"),s.folder,{useEditorClasses:!0});null!==n&&(m(n)?(n||(n=null),e(n)):alert(r("name-not-allowed")))},l=()=>{e(null)};return[{className:"sa-folders-rename-folder",label:r("rename-folder"),callback:a,position:"assetContextMenuAfterDelete",order:10},{className:"sa-folders-remove-folder",label:r("remove-folder"),callback:l,position:"assetContextMenuAfterDelete",order:11}]}{n.target.setAttribute("sa-folders-context-type","asset");const e=e=>{if("SPRITE"===o.props.dragType){const t=i.runtime.getTargetById(o.props.id);i.renameSprite(o.props.id,b(g(t.getName(),e))),T(),i.emitWorkspaceUpdate()}else if("COSTUME"===o.props.dragType){const t=k(o.props).realIndex,n=i.editingTarget.sprite.costumes[t];i.renameCostume(i.editingTarget.sprite.costumes.indexOf(n),g(n.name,e)),L()}else if("SOUND"===o.props.dragType){const t=k(o.props).realIndex,n=i.editingTarget.sprite.sounds[t];i.renameSound(i.editingTarget.sprite.sounds.indexOf(n),g(n.name,e)),N()}},a=async()=>{const n=await t.tab.prompt(r("name-prompt-title"),r("name-prompt"),h(s.realName),{useEditorClasses:!0});null!==n&&(m(n)?e(n):alert(r("name-not-allowed")))},l=[{border:!0,className:"sa-folders-create-folder",label:r("create-folder"),callback:a,position:"assetContextMenuAfterDelete",order:13}],c=s.inFolder;return"string"==typeof c&&l.push({className:"sa-folders-remove-from-folder",label:r("remove-from-folder"),callback:()=>e(null),position:"assetContextMenuAfterDelete",order:14}),l.concat((e=>{const t=new Set;let n;n="SPRITE"===e.props.dragType?d:u;for(const e of n){const n=k(e);"string"==typeof n.folder&&t.add(n.folder)}return Array.from(t)})(o).filter(e=>e!==c).map((t,n)=>({className:"sa-folders-add-to-folder",label:r("add-to-folder",{folder:t}),callback:()=>e(t),position:"assetContextMenuAfterDelete",order:20+n})))}}});const j=e=>{for(const t of["handleDelete","handleDuplicate","handleExport"]){const n=e.prototype[t];e.prototype[t]=function(){for(var e=arguments.length,t=new Array(e),o=0;o<e;o++)t[o]=arguments[o];if("number"==typeof this.props.id){const e=k(this.props);if(e){const o=this.props;this.props=s(s({},o),{},{id:e.realIndex});const r=n.call(this,...t);return this.props=o,r}}return n.call(this,...t)}}const n=e.prototype.handleDragEnd;e.prototype.handleDragEnd=function(){const e=k(this.props);if(e&&"number"==typeof e.realIndex&&this.props.dragging){const n=this.props.index,o=e.realIndex;if(n!==o){const e=t.tab.redux.state.scratchGui.assetDrag.currentOffset,s=v(this.ref);e&&s&&null===s.getMouseOverIndex()&&(this.props.index=o,this.handleDrag(e),this.props.index=n)}}for(var o=arguments.length,s=new Array(o),r=0;r<o;r++)s[r]=arguments[r];return n.call(this,...s)};const o=e.prototype.handleClick;e.prototype.handleClick=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const s=t[0];if(s&&!this.noClick){const e=k(this.props);if(e){if("string"==typeof e.folder)return s.preventDefault(),void B(this,e.folder,!A(this,e.folder));if("number"==typeof this.props.number&&"number"==typeof e.realIndex)return s.preventDefault(),void(this.props.onClick&&this.props.onClick(e.realIndex))}}return o.call(this,...t)};const i=e.prototype.render;e.prototype.render=function(){const e=k(this.props);if(e){const t=this.props;this.props=s({},this.props),"string"==typeof e.realName&&(this.props.name=h(e.realName)),"number"==typeof this.props.number&&"number"==typeof e.realIndex&&(this.props.number=e.realIndex+1),"string"==typeof e.folder&&(this.props.name=e.folder,e.folderOpen?this.props.details=r("open-folder"):this.props.details=r("closed-folder"),this.props.selected=!1,this.props.number=null,this.props.className+=" ".concat(D(e.folder)," sa-folders-folder")),"string"==typeof e.inFolder&&(this.props.className+=" ".concat(D(e.inFolder)));const n=i.call(this);return this.props=t,n}return i.call(this)}},O=()=>{const e=i.runtime.targets[0].constructor,t=i.installTargets;i.installTargets=function(){for(var e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];if(null!==l){const e=n[0],t=n[2];if(Array.isArray(e)&&!t)for(const t of e)t.sprite&&(t.sprite.name=g(t.sprite.name,l))}return t.call(this,...n).then(e=>(T(),e))};const n=e.prototype.addCostume;e.prototype.addCostume=function(){for(var e=arguments.length,t=new Array(e),o=0;o<e;o++)t[o]=arguments[o];if(null!==c){const e=t[0];e&&"string"!=typeof p(e.name)&&(e.name=g(e.name,c))}const s=n.call(this,...t);return L(this),s};const s=e.prototype.addSound;e.prototype.addSound=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(null!==c){const e=t[0];e&&"string"!=typeof p(e.name)&&(e.name=g(e.name,c))}const o=s.call(this,...t);return N(this),o};const r=(e,t,n)=>{let{guiItems:s,getAll:r,set:i,rename:a,getVMItemFromGUIItem:l,zeroIndexed:c,onFolderChanged:d}=e;if((t=y(t,c?0:1,c?s.length-1:s.length))===(n=y(n,c?0:1,c?s.length-1:s.length)))return!1;let u=r();const p=r(),h=s[t-(c?0:1)],m=s[n-(c?0:1)],f=k(h),b=k(m);if(!f||!b)return o.warn("should never happen"),!1;const v=("string"==typeof f.folder?h.items:[h]).map(e=>l(e,u)).filter(e=>e);if("number"==typeof b.realIndex){const e=l(m,u);if(!e||v.includes(e))return!1}let x,w=null;if(u=u.filter(e=>!v.includes(e)),n===(c?0:1))x=c?0:1;else if(n===s.length-(c?1:0))x=u.length;else if("number"==typeof b.realIndex){w="string"==typeof b.inFolder?b.inFolder:null;let e=l(m,u);if(!e)return o.warn("should never happen"),!1;x=u.indexOf(e),n>t&&x++}else{if("string"!=typeof b.folder)return o.warn("should never happen"),!1;{let e,s=0;n<t?e=m.items[0]:b.folderOpen?(e=m.items[0],w=b.folder):(e=m.items[m.items.length-1],s=1);let r=l(e,u);if(r)x=u.indexOf(r)+s;else{if(r=l(e,p),!r)return o.warn("should never happen"),!1;x=p.indexOf(r)+s}}}if("string"!=typeof f.folder||null===w){if(x<(c?0:1)||x>u.length)return o.warn("should never happen"),!1;if(u.splice(x,0,...v),i(u),"string"!=typeof f.folder&&f.inFolder!==w){for(const e of v){const t=e.getName?e.getName():e.name;a(e,g(t,w))}d&&d()}return!0}};i.constructor.prototype.reorderTarget=function(e,t){return r({getAll:()=>this.runtime.targets,set:e=>{this.runtime.targets=e,this.emitTargetsUpdate()},rename:(e,t)=>{this.renameSprite(e.id,b(t))},getVMItemFromGUIItem:(e,t)=>t.find(t=>t.id===e.id),onFolderChanged:()=>{this.emitWorkspaceUpdate()},guiItems:d,zeroIndexed:!1},e,t)},e.prototype.reorderCostume=function(e,t){return r({getAll:()=>this.sprite.costumes,set:e=>{this.sprite.costumes=e},rename:(e,t)=>{this.renameCostume(this.sprite.costumes.indexOf(e),t)},getVMItemFromGUIItem:(e,t)=>{const n=k(e);return t.find(e=>e.name===n.realName)},guiItems:u,zeroIndexed:!0},e,t)},e.prototype.reorderSound=function(e,t){return r({getAll:()=>this.sprite.sounds,set:e=>{this.sprite.sounds=e},rename:(e,t)=>{this.renameSound(this.sprite.sounds.indexOf(e),t)},getVMItemFromGUIItem:(e,t)=>{const n=k(e);return t.find(e=>e.name===n.realName)},guiItems:u,zeroIndexed:!0},e,t)}},R=e=>{const n=e.constructor;n.prototype.sa_loadNextItem=function(){if(!this.sa_queuedItems)return;const e=this.sa_queuedItems.pop();if(e){let t,n;e.dragPayload?(n=e.url?"SOUND":"COSTUME",t=e.dragPayload):e.id&&(n="SPRITE",t=e.id),n&&t&&o.call(this,{dragType:n,payload:t})}},n.prototype.componentDidUpdate=function(e,t){this.state.loading||!t.loading||this.state.error||this.sa_loadNextItem()};const o=n.prototype.handleDrop;n.prototype.handleDrop=function(){for(var e=arguments.length,n=new Array(e),s=0;s<e;s++)n[s]=arguments[s];const i=n[0],a=i&&i.payload&&i.payload.sa_folder_items;if(!Array.isArray(a))return o.call(this,...n);t.tab.confirm("",r("confirm-backpack-folder"),{useEditorClasses:!0}).then(e=>{e&&(this.sa_queuedItems=a,this.sa_loadNextItem())})},e.handleDrop=n.prototype.handleDrop.bind(e)};{const e=t=>{t.target.closest('[class*="backpack_backpack-header_"]')&&setTimeout(()=>{const t=document.querySelector("[class^='backpack_backpack-list_']");if(!t)return;document.removeEventListener("click",e);const n=(e=>{const t=e.closest('[class*="gui_editor-wrapper"]');if(!t)throw new Error("cannot find Backpack");return t[a].child.sibling.child.child.stateNode})(t);(e=>{const t=e.constructor;if("function"!=typeof t.prototype.handleDrop||void 0!==t.prototype.componentDidUpdate)throw new Error("Can not comprehend Backpack")})(n),R(n)})};document.addEventListener("click",e,!0)}{const e=await t.tab.waitForElement("[class^='sprite-selector_sprite-wrapper']",{reduxCondition:e=>!e.scratchGui.mode.isPlayerOnly});i=t.tab.traps.vm,a=Object.keys(e).find(e=>e.startsWith("__reactInternalInstance$"));const n=v(e),o=e[a].child.child.child.stateNode;M(n),(e=>{const t=e.constructor;if("object"!=typeof e.props.asset||"string"!=typeof e.props.name||"string"!=typeof e.props.dragType||"function"!=typeof t.prototype.handleClick||"function"!=typeof t.prototype.setRef||"function"!=typeof t.prototype.handleDrag||"function"!=typeof t.prototype.handleDragEnd||"function"!=typeof t.prototype.handleDelete||"function"!=typeof t.prototype.handleDuplicate||"function"!=typeof t.prototype.handleExport)throw new Error("Can not comprehend SpriteSelectorItem")})(o),(e=>{const t=e.runtime.targets[0];if("function"!=typeof e.installTargets||"function"!=typeof e.reorderTarget||"function"!=typeof t.reorderCostume||"function"!=typeof t.reorderSound||"function"!=typeof t.addCostume||"function"!=typeof t.addSound)throw new Error("Can not comprehend VM")})(i),E(n.constructor,1),j(o.constructor),n.saInitialSetup(),O()}{const e=await t.tab.waitForElement("[class*='selector_list-item']",{reduxCondition:e=>0!==e.scratchGui.editorTab.activeTabIndex&&!e.scratchGui.mode.isPlayerOnly}),n=v(e);M(n),E(n.constructor,2),n.saInitialSetup()}},"style.css":n.n(i).a}},1615:function(e,t,n){"use strict";n.r(t),n.d(t,"resources",(function(){return d}));
/**
 * This file is imported from https://github.com/LLK/scratch-blocks/
 * It has been cleaned up and unnecessary functions have been removed.
 * Original license is below.
 *
 * @license
 * Visual Blocks Editor
 *
 * Copyright 2012 Google Inc.
 * https://developers.google.com/blockly/
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
const o=function(e,t,n){const o=document.createElement(e);if(void 0!==n){Array.isArray(n)||(n=[n]);for(const e of n)"string"==typeof e?o.appendChild(document.createTextNode(e)):o.appendChild(e)}return o},s=e=>{e.parentNode&&e.parentNode.removeChild(e)},r=function(e){if(e.name&&e.SERIALIZABLE){if(e.referencesVariables())return function(e){null==e.getValue()&&e.initModel();var t=e.getVariable();if(!t)throw Error("Tried to serialize a variable field with no variable.");var n=o("field",0,t.name);return n.setAttribute("name",e.name),n.setAttribute("id",t.getId()),n.setAttribute("variabletype",t.type),n}(e);var t=o("field",0,e.getValue());return t.setAttribute("name",e.name),t}return null},i=function e(t,n){var s=o(t.isShadow()?"shadow":"block");if(s.setAttribute("type",t.type),n||s.setAttribute("id",t.id),t.mutationToDom){var i=t.mutationToDom();i&&(i.hasChildNodes()||i.hasAttributes())&&s.appendChild(i)}if(function(e,t){for(var n,o=0;n=e.inputList[o];o++)for(var s,i=0;s=n.fieldRow[i];i++){var a=r(s);a&&t.appendChild(a)}}(t,s),a(t,s),t.data){var c=o("data",0,t.data);s.appendChild(c)}for(var d,u=0;d=t.inputList[u];u++){var p=!0;if(5!=d.type){var h=d.connection.targetBlock();if(1==d.type?b=o("value"):3==d.type&&(b=o("statement")),(m=d.connection.getShadowDom())&&(!h||!h.isShadow())){var g=l(m);n&&g.getAttribute("id")&&g.removeAttribute("id"),b.appendChild(g)}h&&(b.appendChild(e(h,n)),p=!1),b.setAttribute("name",d.name),p||s.appendChild(b)}}t.inputsInlineDefault!=t.inputsInline&&s.setAttribute("inline",t.inputsInline),t.isCollapsed()&&s.setAttribute("collapsed",!0),t.disabled&&s.setAttribute("disabled",!0),t.isDeletable()||t.isShadow()||s.setAttribute("deletable",!1),t.isMovable()||t.isShadow()||s.setAttribute("movable",!1),t.isEditable()||s.setAttribute("editable",!1);var m,f=t.getNextBlock();if(f){var b=o("next",0,e(f,n));s.appendChild(b)}return!(m=t.nextConnection&&t.nextConnection.getShadowDom())||f&&f.isShadow()||b.appendChild(l(m)),s},a=function(e,t){var n=e.getCommentText();if(n){var s=o("comment",0,n);if("object"==typeof e.comment){var r;s.setAttribute("id",e.comment.id),s.setAttribute("pinned",e.comment.isVisible()),r=e.comment.getHeightWidth?e.comment.getHeightWidth():e.comment.getBubbleSize(),s.setAttribute("h",r.height),s.setAttribute("w",r.width);var i=e.comment.getXY();s.setAttribute("x",i.x),s.setAttribute("y",i.y),s.setAttribute("minimized",e.comment.isMinimized())}t.appendChild(s)}},l=function(e){for(var t,n=e=e.cloneNode(!0);n;)if(n.firstChild)n=n.firstChild;else{for(;n&&!n.nextSibling;)t=n,n=n.parentNode,3==t.nodeType&&""==t.data.trim()&&n.firstChild!=t&&s(t);n&&(t=n,n=n.nextSibling,3==t.nodeType&&""==t.data.trim()&&s(t))}return e};var c=e=>{const t=i(e,!1),n=e.getRelativeToSurfaceXY();return t.setAttribute("x",Math.round(e.workspace.RTL?-n.x:n.x)),t.setAttribute("y",Math.round(n.y)),t};const d={"userscript.js":async function(e){let{addon:t,global:n,console:o,msg:s}=e;const r=await t.tab.traps.getBlockly(),i=t.tab.traps.vm;let a={},l={};const d={isNoop:!0},u=()=>{if(a={},l={},t.settings.get("motion")&&(a.motion_turnright=[d,{opcode:"motion_turnleft"}],a.motion_turnleft=[{opcode:"motion_turnright"},d],a.motion_setx=[d,{opcode:"motion_changexby",remap:{X:"DX"}},{opcode:"motion_sety",remap:{X:"Y"}},{opcode:"motion_changeyby",remap:{X:"DY"}}],a.motion_changexby=[{opcode:"motion_setx",remap:{DX:"X"}},d,{opcode:"motion_sety",remap:{DX:"Y"}},{opcode:"motion_changeyby",remap:{DX:"DY"}}],a.motion_sety=[{opcode:"motion_setx",remap:{Y:"X"}},{opcode:"motion_changexby",remap:{Y:"DX"}},d,{opcode:"motion_changeyby",remap:{Y:"DY"}}],a.motion_changeyby=[{opcode:"motion_setx",remap:{DY:"X"}},{opcode:"motion_changexby",remap:{DY:"DX"}},{opcode:"motion_sety",remap:{DY:"Y"}},d],a.motion_xposition=[d,{opcode:"motion_yposition"}],a.motion_yposition=[{opcode:"motion_xposition"},d]),t.settings.get("looks")&&(a.looks_seteffectto=[d,{opcode:"looks_changeeffectby",remap:{VALUE:"CHANGE"}}],a.looks_changeeffectby=[{opcode:"looks_seteffectto",remap:{CHANGE:"VALUE"}},d],a.looks_setsizeto=[d,{opcode:"looks_changesizeby",remap:{SIZE:"CHANGE"}}],a.looks_changesizeby=[{opcode:"looks_setsizeto",remap:{CHANGE:"SIZE"}},d],a.looks_costumenumbername=[d,{opcode:"looks_backdropnumbername"}],a.looks_backdropnumbername=[{opcode:"looks_costumenumbername"},d],a.looks_show=[d,{opcode:"looks_hide"}],a.looks_hide=[{opcode:"looks_show"},d],a.looks_nextcostume=[d,{opcode:"looks_nextbackdrop"}],a.looks_nextbackdrop=[{opcode:"looks_nextcostume"},d],a.looks_think=[d,{opcode:"looks_say"}],a.looks_say=[{opcode:"looks_think"},d],a.looks_thinkforsecs=[d,{opcode:"looks_sayforsecs"}],a.looks_sayforsecs=[{opcode:"looks_thinkforsecs"},d],a.looks_switchbackdropto=[d,{opcode:"looks_switchbackdroptoandwait"}],a.looks_switchbackdroptoandwait=[{opcode:"looks_switchbackdropto"},d]),t.settings.get("sound")&&(a.sound_play=[d,{opcode:"sound_playuntildone"}],a.sound_playuntildone=[{opcode:"sound_play"},d],a.sound_seteffectto=[d,{opcode:"sound_changeeffectby"}],a.sound_changeeffectby=[{opcode:"sound_seteffectto"},d],a.sound_setvolumeto=[d,{opcode:"sound_changevolumeby"}],a.sound_changevolumeby=[{opcode:"sound_setvolumeto"},d]),t.settings.get("event")&&(a.event_broadcast=[d,{opcode:"event_broadcastandwait"}],a.event_broadcastandwait=[{opcode:"event_broadcast"},d]),t.settings.get("control")&&(a.control_if=[d,{opcode:"control_if_else"}],a.control_if_else=[{opcode:"control_if",remap:{SUBSTACK2:"split"}},d],a.control_repeat_until=[d,{opcode:"control_wait_until",remap:{SUBSTACK:"split"}},{opcode:"control_forever",remap:{CONDITION:"split"}}],a.control_forever=[{opcode:"control_repeat_until"},d],a.control_wait_until=[{opcode:"control_repeat_until"},d]),t.settings.get("operator")&&(a.operator_equals=[{opcode:"operator_gt"},d,{opcode:"operator_lt"}],a.operator_gt=[d,{opcode:"operator_equals"},{opcode:"operator_lt"}],a.operator_lt=[{opcode:"operator_gt"},{opcode:"operator_equals"},d],a.operator_add=[d,{opcode:"operator_subtract"},{opcode:"operator_multiply"},{opcode:"operator_divide"},{opcode:"operator_mod"}],a.operator_subtract=[{opcode:"operator_add"},d,{opcode:"operator_multiply"},{opcode:"operator_divide"},{opcode:"operator_mod"}],a.operator_multiply=[{opcode:"operator_add"},{opcode:"operator_subtract"},d,{opcode:"operator_divide"},{opcode:"operator_mod"}],a.operator_divide=[{opcode:"operator_add"},{opcode:"operator_subtract"},{opcode:"operator_multiply"},d,{opcode:"operator_mod"}],a.operator_mod=[{opcode:"operator_add"},{opcode:"operator_subtract"},{opcode:"operator_multiply"},{opcode:"operator_divide"},d],a.operator_and=[d,{opcode:"operator_or"}],a.operator_or=[{opcode:"operator_and"},d]),t.settings.get("sensing")&&(a.sensing_mousex=[d,{opcode:"sensing_mousey"}],a.sensing_mousey=[{opcode:"sensing_mousex"},d]),t.settings.get("data")&&(a.data_setvariableto=[d,{opcode:"data_changevariableby",remapValueType:{VALUE:"math_number"}}],a.data_changevariableby=[{opcode:"data_setvariableto",remapValueType:{VALUE:"text"}},d],a.data_showvariable=[d,{opcode:"data_hidevariable"}],a.data_hidevariable=[{opcode:"data_showvariable"},d],a.data_showlist=[d,{opcode:"data_hidelist"}],a.data_hidelist=[{opcode:"data_showlist"},d],a.data_replaceitemoflist=[d,{opcode:"data_insertatlist"}],a.data_insertatlist=[{opcode:"data_replaceitemoflist"},d]),t.settings.get("extension")&&(a.pen_penDown=[d,{opcode:"pen_penUp"}],a.pen_penUp=[{opcode:"pen_penDown"},d],a.pen_setPenColorParamTo=[d,{opcode:"pen_changePenColorParamBy"}],a.pen_changePenColorParamBy=[{opcode:"pen_setPenColorParamTo"},d],a.pen_setPenHueToNumber=[d,{opcode:"pen_changePenHueBy"}],a.pen_changePenHueBy=[{opcode:"pen_setPenHueToNumber"},d],a.pen_setPenShadeToNumber=[d,{opcode:"pen_changePenShadeBy"}],a.pen_changePenShadeBy=[{opcode:"pen_setPenShadeToNumber"},d],a.pen_setPenSizeTo=[d,{opcode:"pen_changePenSizeBy"}],a.pen_changePenSizeBy=[{opcode:"pen_setPenSizeTo"},d],a.music_setTempo=[d,{opcode:"music_changeTempo"}],a.music_changeTempo=[{opcode:"music_setTempo"},d]),t.settings.get("sa")){const e="​​log​​ %s",t="​​warn​​ %s",n="​​error​​ %s",o=s("debugger_log"),r=s("debugger_warn"),i=s("debugger_error"),a={mutate:{proccode:e},msg:o},c={mutate:{proccode:t},msg:r},d={mutate:{proccode:n},msg:i};l[e]=[{msg:o,isNoop:!0},c,d],l[t]=[a,{msg:r,isNoop:!0},d],l[n]=[a,c,{msg:i,isNoop:!0}]}a.data_variable=[],a.data_listcontents=[]};u(),t.settings.addEventListener("change",u);const p=(e,t)=>()=>{if(t.isNoop)return;if(t.fieldValue)return void e.setFieldValue(t.fieldValue,"VALUE");const n=e.workspace,o=c(e);t.opcode&&o.setAttribute("type",t.opcode);const s=e.id,i=e.getParent();let a,l;if(i){a=i.getConnections_().find(t=>t.targetConnection&&t.targetConnection.sourceBlock_===e);const t=e.getConnections_().find(e=>e.targetConnection&&e.targetConnection.sourceBlock_===i);l=t.type}const d=[];if(t.remap)for(const e of Array.from(o.children)){const s=e.getAttribute("name"),r=t.remap[s];if(r)if("split"===r){const t=e.firstChild,s=t.id,r=n.getBlockById(s).getRelativeToSurfaceXY();t.setAttribute("x",Math.round(n.RTL?-r.x:r.x)),t.setAttribute("y",Math.round(r.y)),d.push(t),o.removeChild(e)}else e.setAttribute("name",r)}if(t.remapValueType)for(const e of Array.from(o.children)){const n=e.getAttribute("name"),o=t.remapValueType[n];if(o){const t=e.firstChild,n=t.firstChild;t.setAttribute("type",o),n.setAttribute("name","text"===o?"TEXT":"NUM")}}if(t.mutate){const e=o.querySelector("mutation");for(const[n,o]of Object.entries(t.mutate))e.setAttribute(n,o)}try{r.Events.setGroup(!0),e.dispose(),n.paste(o);for(const e of d)n.paste(e);const t=n.getBlockById(s);if(a){const e=t.getConnections_();e.find(e=>e.type===l).connect(a)}}finally{r.Events.setGroup(!1)}};t.tab.createBlockContextMenu((e,n)=>{if(!t.self.disabled){const i=n.type;let c=a[n.type]||[];const d=t.settings.get("customargs")?t.settings.get("customargsmode"):"off";if("off"!==d&&["argument_reporter_boolean","argument_reporter_string_number"].includes(i)&&!n.isShadow()){const t=h();if("all"===d)switch(i){case"argument_reporter_string_number":c=Object.values(t).map(e=>e.stringArgs).flat(1);break;case"argument_reporter_boolean":c=Object.values(t).map(e=>e.boolArgs).flat(1)}else if("defOnly"===d){const o=n.getRootBlock();if("procedures_definition"!==o.type)return e;const s=t[o.getChildren(!0)[0].getProcCode()];switch(i){case"argument_reporter_string_number":c=s.stringArgs;break;case"argument_reporter_boolean":c=s.boolArgs}}const s=n.getFieldValue("VALUE");c=(o=c,[...new Set(o)]).map(e=>({isNoop:e===s,fieldValue:e,msg:e}))}if("procedures_call"===n.type){const e=n.getProcCode();l[e]&&(c=l[e])}if(t.settings.get("noop")||(c=c.filter(e=>!e.isNoop)),c.forEach((o,r)=>{const i=e.findIndex(e=>e._isDevtoolsFirstItem),a=-1!==i?i:e.length,l=o.msg?o.msg:o.opcode?s(o.opcode):s(n.type);e.splice(a,0,{enabled:!0,text:l,callback:p(n,o),separator:t.settings.get("border")&&0===r})}),t.settings.get("border")&&("data_variable"===n.type||"data_listcontents"===n.type)){const t=e.findIndex(e=>e.text===r.Msg.DELETE_BLOCK),n=e[t+1];n&&(n.separator=!0)}}var o;return e},{blocks:!0});const h=()=>{const e={},t=i.editingTarget;return Object.values(t.blocks._blocks).filter(e=>"procedures_prototype"===e.opcode).forEach(t=>{const n=t.mutation.proccode,o=JSON.parse(t.mutation.argumentnames),s=n.split(/(?=[^\\]%[nbs])/g).map(e=>e.trim()).filter(e=>"%"===e.charAt(0)).map(e=>e.substring(0,2));const r=[],i=[];for(let e=0;e<o.length;e++)"%b"===s[e]?i.push(o[e]):r.push(o[e]);e[n]={stringArgs:r,boolArgs:i}}),e}}}},1618:function(e,t,n){"use strict";n.r(t),n.d(t,"resources",(function(){return s}));var o=n(1541);const s={"userscript.js":async function(e){let{addon:t,global:n,console:o,msg:s}=e;const r=await t.tab.traps.getBlockly(),i=t.tab.traps.vm,a=["RENAME_VARIABLE_ID","DELETE_VARIABLE_ID","NEW_BROADCAST_MESSAGE_ID"],l=["createGlobalVariable","createLocalVariable","createGlobalList","createLocalList","createBroadcast"];let c=null,d=null,u=null,p=[],h=[],g=[],m=[];const f=r.DropDownDiv.show;r.DropDownDiv.show=function(){d=document.querySelector(".blocklyDropdownMenu");for(var e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];if(!d)return f.call(this,...n);d.focus=()=>{},u=document.createElement("input"),t.tab.displayNoneWhileDisabled(u,{display:"flex"}),u.type="text",u.addEventListener("input",x),u.addEventListener("keydown",w),u.classList.add("u-dropdown-searchbar"),d.insertBefore(u,d.firstChild),p=Array.from(d.children).filter(e=>"INPUT"!==e.tagName).map(e=>({element:e,text:e.textContent})),g=m,x();const s=f.call(this,...n);return c=r.DropDownDiv.getContentDiv(),c.style.width=getComputedStyle(c).width,c.style.height=getComputedStyle(c).height,d.insertBefore(u,d.firstChild),u.focus(),s};const b=r.DropDownDiv.clearContent;r.DropDownDiv.clearContent=function(){b.call(this),p=[],h=[],r.DropDownDiv.content_.style.height=""};const v=r.FieldDropdown.prototype.getOptions;r.FieldDropdown.prototype.getOptions=function(){const e=v.call(this),t=this.sourceBlock_,n=i.editingTarget&&i.editingTarget.isStage;return t&&("data"===t.category_?(e.push(I("createGlobalVariable")),n||e.push(I("createLocalVariable"))):"data-lists"===t.category_?(e.push(I("createGlobalList")),n||e.push(I("createLocalList"))):"event_broadcast_menu"!==t.type&&"event_whenbroadcastreceived"!==t.type||e.push(I("createBroadcast"))),m=e,e};const y=r.FieldVariable.prototype.onItemSelected;function k(e,t){e.dispatchEvent(new MouseEvent("mousedown",{relatedTarget:e,bubbles:!0})),t&&e.dispatchEvent(new MouseEvent("mouseup",{relatedTarget:e,bubbles:!0}));const n=e.offsetTop,o=n+e.offsetHeight,s=c.scrollTop,r=c.offsetHeight,i=s+r;s>n?c.scrollTop=n:o>i&&(c.scrollTop=o-r)}function x(){const e=h;h=function(){const e=u.value.toLowerCase().trim(),t=(t,n)=>{const o=g[n];if(a.includes(o[1]))return e?-1:0;if(l.includes(o[1]))return t.element.lastChild.lastChild.textContent=I(o[1])[0],e?0:-1;const s=t.text.toLowerCase();return e===s?2:s.startsWith(e)?1:s.includes(e)?0:-1};return p.map((e,n)=>({item:e,score:t(e,n)})).sort((e,t)=>{let{score:n}=e,{score:o}=t;return Math.max(0,o)-Math.max(0,n)})}();let t=e.length!==h.length;if(!t)for(let n=0;n<h.length;n++)if(h[n].item!==e[n].item){t=!0;break}if(t&&e.length>0){for(const{item:t}of e)t.element.remove();for(const{item:e}of h)d.appendChild(e.element)}for(const{item:e,score:t}of h)e.element.hidden=t<0}function w(e){if("Enter"===e.key){e.stopPropagation(),e.preventDefault();const t=document.querySelector(".goog-menuitem-highlight");if(t&&!t.hidden)return void k(t,!0);const n=r.selected;if(""===u.value&&n&&("event_broadcast"===n.type||"event_broadcastandwait"===n.type||"event_whenbroadcastreceived"===n.type))return void r.DropDownDiv.hide();for(const{item:e}of h)if(!e.element.hidden){k(e.element,!0);break}}else if("Escape"===e.key)r.DropDownDiv.hide();else if("ArrowDown"===e.key||"ArrowUp"===e.key){e.preventDefault(),e.stopPropagation();const t=h.filter(e=>e.score>=0).map(e=>e.item);if(0===t.length)return;let n=-1;for(let e=0;e<t.length;e++)if(t[e].element.classList.contains("goog-menuitem-highlight")){n=e;break}const o=t.length-1;let s=0;s="ArrowDown"===e.key?-1===n||n===o?0:n+1:-1===n||0===n?o:n-1,k(t[s].element,!1)}}function I(e){var t;return[s(e,{name:(null===(t=u)||void 0===t?void 0:t.value)||""}),e]}r.FieldVariable.prototype.onItemSelected=function(e,t){const n=this.sourceBlock_;if(n&&n.workspace&&0!==u.value.length){const e=n.workspace;switch(t.getValue()){case"createGlobalVariable":{r.Events.setGroup(!0);const t=e.createVariable(u.value);return this.sourceBlock_&&this.setValue(t.getId()),void r.Events.setGroup(!1)}case"createLocalVariable":{r.Events.setGroup(!0);const t=e.createVariable(u.value,"",null,!0);return this.sourceBlock_&&this.setValue(t.getId()),void r.Events.setGroup(!1)}case"createGlobalList":{r.Events.setGroup(!0);const t=e.createVariable(u.value,"list");return this.sourceBlock_&&this.setValue(t.getId()),void r.Events.setGroup(!1)}case"createLocalList":{r.Events.setGroup(!0);const t=e.createVariable(u.value,"list",null,!0);return this.sourceBlock_&&this.setValue(t.getId()),void r.Events.setGroup(!1)}case"createBroadcast":{r.Events.setGroup(!0);const t=e.createVariable(u.value,"broadcast_msg");return this.setValue(t.getId()),void r.Events.setGroup(!1)}}}return y.call(this,e,t)}},"userscript.css":n.n(o).a}},1626:function(e,t,n){"use strict";n.r(t),n.d(t,"resources",(function(){return o}));const o={"userscript.js":async e=>{let{addon:t,console:n}=e;if(!t.tab.redux.state)return n.warn("Redux is not available!");t.tab.redux.initialize(),t.tab.redux.addEventListener("statechanged",e=>{let{detail:o}=e;if(t.self.disabled)return;const s=o;if(!s.action||"scratch-paint/clipboard/SET"!==s.action.type)return;const r=s.next.scratchPaint.clipboard.items;if(1!==r.length)return;const i=r[0];if(!Array.isArray(i)||"Raster"!==i[0])return n.log("copied element is vector");const a=i[1].source;t.tab.copyImage(a).then(()=>n.log("Image successfully copied")).catch(e=>n.error("Image could not be copied: ".concat(e)))})}}},1637:function(e,t,n){"use strict";n.r(t),n.d(t,"resources",(function(){return o}));const o={"userscript.js":async function(e){let{addon:t,global:n,console:o}=e;const s=await t.tab.traps.getBlockly();let r=!1;document.addEventListener("mousedown",(function(e){r=e.ctrlKey||e.metaKey}),{capture:!0});const i=s.Gesture.prototype.startDraggingBlock_;s.Gesture.prototype.startDraggingBlock_=function(){if(!t.self.disabled){const e=!(this.mostRecentEvent_ instanceof MouseEvent),n=this.targetBlock_,o=t.settings.get("invertDrag")&&!e&&n.getParent();if(r===!o){if(s.Events.getGroup()||s.Events.setGroup(!0),e){const e=n.getNextBlock();e&&e.dispose()}n.unplug(!0)}}for(var e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return i.call(this,...n)}}}},1642:function(e,t,n){"use strict";n.r(t),n.d(t,"resources",(function(){return o}));const o={"userscript.js":async e=>{let{addon:t,console:n,msg:o}=e;const s=["sound","costume"];t.tab.createEditorContextMenu(e=>{const n=t.tab.traps.vm.editingTarget;"sound"===e.type?n.reorderSound(e.index,0):n.reorderCostume(e.index,0),queueMicrotask(()=>{t.tab.traps.vm.emitTargetsUpdate(),t.tab.traps.vm.runtime.emitProjectChanged(),e.target.click()})},{types:s,position:"assetContextMenuAfterExport",order:1,label:o("top"),condition:e=>0!==e.index}),t.tab.createEditorContextMenu(e=>{const n=t.tab.traps.vm.editingTarget;"sound"===e.type?n.reorderSound(e.index,1/0):n.reorderCostume(e.index,1/0),queueMicrotask(()=>{t.tab.traps.vm.emitTargetsUpdate(),t.tab.traps.vm.runtime.emitProjectChanged(),e.target.click()})},{types:s,position:"assetContextMenuAfterExport",order:2,label:o("bottom"),condition:e=>e.index!==e.target.parentNode.parentNode.childElementCount-1})}}},1644:function(e,t,n){"use strict";n.r(t),n.d(t,"resources",(function(){return o}));const o={"userscript.js":async function(e){let{addon:t,global:n,console:o}=e;const s=await t.tab.traps.getBlockly(),r=s.Gesture.prototype.startDraggingBlock_;s.Gesture.prototype.startDraggingBlock_=function(){if(!this.flyout_&&!this.shouldDuplicateOnDrag_&&"procedures_definition"!==this.targetBlock_.type&&this.mostRecentEvent_.altKey&&!t.self.disabled){let e;s.Events.getGroup()||s.Events.setGroup(!0),this.startWorkspace_.setResizesEnabled(!1),s.Events.disable();try{const t=s.Xml.blockToDom(this.targetBlock_);e=s.Xml.domToBlock(t,this.startWorkspace_),s.scratchBlocksUtils.changeObscuredShadowIds(e);const n=this.targetBlock_.getRelativeToSurfaceXY();if(e.moveBy(n.x,n.y),this.mostRecentEvent_.ctrlKey||this.mostRecentEvent_.metaKey){const t=e.getNextBlock();t&&t.dispose()}}catch(e){o.error(e)}s.Events.enable(),e&&(this.targetBlock_=e,s.Events.isEnabled()&&s.Events.fire(new s.Events.BlockCreate(e)))}for(var e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];return r.call(this,...n)}}}},1646:function(e,t,n){"use strict";n.r(t),n.d(t,"resources",(function(){return s}));var o=n(1592);const s={"userscript.js":async function(e){let{addon:t,global:n,console:o}=e;const s=t.tab.traps.vm,r=()=>{p.classList.toggle("sa-comment-preview-delay","none"!==t.settings.get("delay")),p.classList.toggle("sa-comment-preview-reduce-transparency",t.settings.get("reduce-transparency")),p.classList.toggle("sa-comment-preview-fade",!t.settings.get("reduce-animation"))};let i=null,a=null,l=0,c=0,d=!1;const u=document.createElement("div");u.classList.add("sa-comment-preview-outer");const p=document.createElement("div");p.classList.add("sa-comment-preview-inner"),p.classList.add("sa-comment-preview-hidden"),r(),t.settings.addEventListener("change",r),u.appendChild(p),document.body.appendChild(u);const h=e=>s.editingTarget.blocks.getBlock(e)||s.runtime.flyoutBlocks.getBlock(e),g=e=>e&&e.comment&&s.editingTarget.comments[e.comment],m=()=>{u.style.transform="translate(".concat(l+8,"px, ").concat(c+8,"px)")},f=()=>{i&&(i=null,p.classList.add("sa-comment-preview-hidden"))};document.addEventListener("mouseover",e=>{if(t.self.disabled)return;if(clearTimeout(a),d)return;const n=e.target.closest(".blocklyBubbleCanvas > g, .blocklyBlockCanvas .blocklyDraggable[data-id]");if(n===i)return;if(!n)return void f();let o=null;if(t.settings.get("hover-view")&&e.target.closest(".blocklyBubbleCanvas > g")&&!e.target.closest("line")){if("none"!==n.querySelector("text.scratchCommentText").getAttribute("display")){const e=n.querySelector("textarea");o=e.value}}else if(e.target.closest(".blocklyBlockCanvas .blocklyDraggable[data-id]")){const e=n.dataset.id,r=h(e),i=g(r);if(t.settings.get("hover-view-block")&&i)o=i.text;else if(r&&"procedures_call"===r.opcode&&t.settings.get("hover-view-procedure")){const e=(e=>{const t=Object.values(s.editingTarget.blocks._blocks).find(t=>"procedures_prototype"===t.opcode&&t.mutation.proccode===e);if(t){if(t.parent)return h(t.parent);const e=t.id;return Object.values(s.editingTarget.blocks._blocks).find(t=>"procedures_definition"===t.opcode&&t.inputs.custom_block&&t.inputs.custom_block.block===e)}return null})(r.mutation.proccode),t=g(e);t&&(o=t.text)}}null!==o&&""!==o.trim()?a=(e=>{if(!p.classList.contains("sa-comment-preview-hidden"))return void e();const n=t.settings.get("delay");return"long"===n?setTimeout(e,500):"short"===n?setTimeout(e,300):void e()})(()=>{i=n,(e=>{p.innerText=e,p.classList.remove("sa-comment-preview-hidden"),m()})(o)}):f()}),document.addEventListener("mousemove",e=>{l=e.clientX,c=e.clientY,d=!1,t.settings.get("follow-mouse")&&!p.classList.contains("sa-comment-preview-hidden")&&m()}),document.addEventListener("mousedown",()=>{f(),d=!0},{capture:!0})},"userstyle.css":n.n(o).a}}}]);