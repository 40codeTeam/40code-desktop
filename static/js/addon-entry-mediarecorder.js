(window.webpackJsonpGUI=window.webpackJsonpGUI||[]).push([[34],{1576:function(e,t,n){"use strict";t.a=(e,t)=>{const n=document.createElement("a");if(document.body.appendChild(n),navigator.msSaveOrOpenBlob)navigator.msSaveOrOpenBlob(t,e);else if("download"in HTMLAnchorElement.prototype){const a=window.URL.createObjectURL(t);n.href=a,n.download=e,n.type=t.type,n.click(),window.setTimeout(()=>{document.body.removeChild(n),window.URL.revokeObjectURL(a)},1e3)}else{let e=window.open("","_blank");const n=new FileReader;n.onloadend=function(){e.location.href=n.result,e=null},n.readAsDataURL(t)}}},1633:function(e,t,n){(e.exports=n(9)(!1)).push([e.i,'.mediaRecorderPopup {\n  box-sizing: border-box;\n  width: 700px;\n  max-height: min(800px, 80vh);\n  max-width: 85%;\n  margin-top: 12vh;\n  overflow-y: auto;\n  margin-left: auto;\n  margin-right: auto;\n}\n\n.mediaRecorderPopupContent {\n  padding: 1.5rem 2.25rem;\n}\n\n.mediaRecorderPopup p {\n  font-size: 1rem;\n  margin: 0.5rem auto;\n}\n\n.mediaRecorderPopup p :last-child {\n  margin-left: 1rem;\n}\n\n.mediaRecorderPopup[dir="rtl"] p :last-child {\n  margin-left: 0;\n  margin-right: 1rem;\n}\n\np.mediaRecorderPopupOption {\n  display: flex;\n  align-items: center;\n}\n\n.mediaRecorderPopupOption input[type="checkbox"] {\n  height: 1.5rem;\n}\n\n#recordOptionSecondsInput,\n#recordOptionDelayInput {\n  width: 6rem;\n}\n\n.mediaRecorderPopupButtons {\n  margin-top: 1.5rem;\n}\n\n.mediaRecorderPopupButtons button {\n  margin-left: 0.5rem;\n}\n\n/* TW: Fixes cancel button in dark mode */\n.mediaRecorderPopupButtons button:nth-of-type(1) {\n  color: black;\n}\n',""])},1697:function(e,t,n){"use strict";n.r(t),n.d(t,"resources",(function(){return r}));var a=n(1576),o=n(1633);const r={"userscript.js":async({addon:e,console:t,msg:n})=>{let o,r,c,i=!1,d=!1,l=null,s=null,p=null,m=[];for(;;){const u=await e.tab.waitForElement('div[class*="menu-bar_file-group"] > div:last-child:not(.sa-record)',{markAsSeen:!0,reduxEvents:["scratch-gui/mode/SET_PLAYER","fontsLoaded/SET_FONTS_LOADED","scratch-gui/locales/SELECT_LOCALE"]}),b=()=>{const{backdrop:t,container:a,content:o,closeButton:r,remove:c}=e.tab.createModal(n("option-title"),{isOpen:!0,useEditorClasses:!0});a.classList.add("mediaRecorderPopup"),o.classList.add("mediaRecorderPopupContent"),o.appendChild(Object.assign(document.createElement("p"),{textContent:n("record-description"),className:"recordOptionDescription"}));const i=document.createElement("p"),d=Object.assign(document.createElement("input"),{type:"number",min:1,max:300,defaultValue:30,id:"recordOptionSecondsInput",className:e.tab.scratchClass("prompt_variable-name-text-input")}),l=Object.assign(document.createElement("label"),{htmlFor:"recordOptionSecondsInput",textContent:n("record-duration")});i.appendChild(l),i.appendChild(d),o.appendChild(i);const s=document.createElement("p"),p=Object.assign(document.createElement("input"),{type:"number",min:0,max:300,defaultValue:0,id:"recordOptionDelayInput",className:e.tab.scratchClass("prompt_variable-name-text-input")}),m=Object.assign(document.createElement("label"),{htmlFor:"recordOptionDelayInput",textContent:n("start-delay")});s.appendChild(m),s.appendChild(p),o.appendChild(s);const u=Object.assign(document.createElement("p"),{className:"mediaRecorderPopupOption"}),b=Object.assign(document.createElement("input"),{type:"checkbox",defaultChecked:!0,id:"recordOptionAudioInput"}),h=Object.assign(document.createElement("label"),{htmlFor:"recordOptionAudioInput",textContent:n("record-audio"),title:n("record-audio-description")});u.appendChild(b),u.appendChild(h),o.appendChild(u);const g=Object.assign(document.createElement("p"),{className:"mediaRecorderPopupOption"}),O=Object.assign(document.createElement("input"),{type:"checkbox",defaultChecked:!1,id:"recordOptionMicInput"}),C=Object.assign(document.createElement("label"),{htmlFor:"recordOptionMicInput",textContent:n("record-mic")});g.appendChild(O),g.appendChild(C),o.appendChild(g);const E=Object.assign(document.createElement("p"),{className:"mediaRecorderPopupOption"}),f=Object.assign(document.createElement("input"),{type:"checkbox",defaultChecked:!0,id:"recordOptionFlagInput"}),w=Object.assign(document.createElement("label"),{htmlFor:"recordOptionFlagInput",textContent:n("record-after-flag")});E.appendChild(f),E.appendChild(w),o.appendChild(E);const v=Object.assign(document.createElement("p"),{className:"mediaRecorderPopupOption"}),x=Object.assign(document.createElement("input"),{type:"checkbox",defaultChecked:!0,id:"recordOptionStopInput"}),k=Object.assign(document.createElement("label"),{htmlFor:"recordOptionStopInput",textContent:n("record-until-stop")});f.addEventListener("change",()=>{(x.disabled=!f.checked)&&(k.title=n("record-until-stop-disabled",{afterFlagOption:n("record-after-flag")}))}),v.appendChild(x),v.appendChild(k),o.appendChild(v);let R=null;const y=new Promise(e=>{R=e});let P=null;t.addEventListener("click",()=>P(null)),r.addEventListener("click",()=>P(null)),P=e=>{R(e),c()};const S=Object.assign(document.createElement("div"),{className:e.tab.scratchClass("prompt_button-row",{others:"mediaRecorderPopupButtons"})}),j=Object.assign(document.createElement("button"),{textContent:n("cancel")});j.addEventListener("click",()=>P(null),{once:!0}),S.appendChild(j);const T=Object.assign(document.createElement("button"),{textContent:n("start"),className:e.tab.scratchClass("prompt_ok-button")});return T.addEventListener("click",()=>P({secs:Number(d.value),delay:Number(p.value),audioEnabled:b.checked,micEnabled:O.checked,waitUntilFlag:f.checked,useStopSign:!x.disabled&&x.checked}),{once:!0}),S.appendChild(T),o.appendChild(S),y},h=()=>{i=!1,o.textContent=n("record"),o.title="",r=null,m=[],clearTimeout(c),c=0,p&&(e.tab.traps.vm.runtime.off("PROJECT_STOP_ALL",p),p=null)},g=t=>{if(d)return e.tab.traps.vm.runtime.off("PROJECT_START",l),d=!1,l=null,s.abort(),s=null,void h();i&&r&&"inactive"!==r.state&&(t?h():(r.onstop=()=>{const e=new Blob(m,{type:"video/webm"});Object(a.a)("video.webm",e),h()},r.stop()))},O=async a=>{const u=Math.min(300,Math.max(1,a.secs));m=[],i=!0;const b=e.tab.traps.vm;let h;if(a.micEnabled)try{h=await navigator.mediaDevices.getUserMedia({audio:!0})}catch(e){if("NotAllowedError"!==e.name&&"NotFoundError"!==e.name)throw e;a.micEnabled=!1}if(a.waitUntilFlag){d=!0,Object.assign(o,{textContent:n("click-flag"),title:n("click-flag-description")}),s=new AbortController;try{await Promise.race([new Promise(e=>{l=()=>e(),b.runtime.once("PROJECT_START",l)}),new Promise((e,t)=>{s.signal.addEventListener("abort",()=>t("aborted"),{once:!0})})])}catch(e){if("aborted"===e.message)return;throw e}}d=!1,l=s=null;const O=new MediaStream,C=b.runtime.renderer.canvas.captureStream();O.addTrack(C.getVideoTracks()[0]);const E=new AudioContext,f=E.createMediaStreamDestination();if(a.audioEnabled){const e=b.runtime.audioEngine.audioContext.createMediaStreamDestination();b.runtime.audioEngine.inputNode.connect(e);E.createMediaStreamSource(e.stream).connect(f)}if(a.micEnabled){E.createMediaStreamSource(h).connect(f)}(a.audioEnabled||a.micEnabled)&&O.addTrack(f.stream.getAudioTracks()[0]),r=new MediaRecorder(O,{mimeType:"video/webm"}),r.ondataavailable=e=>{m.push(e.data)},r.onerror=e=>{t.warn("Recorder error:",e.error),g(!0)},c=setTimeout(()=>g(!1),1e3*u),a.useStopSign&&(p=()=>g(),b.runtime.once("PROJECT_STOP_ALL",p));const w=a.delay||0,v=Math.floor(w);for(let e=0;e<v;e++)o.textContent=n("starting-in",{secs:v-e}),await new Promise(e=>setTimeout(e,975));setTimeout(()=>{o.textContent=n("stop"),r.start(1e3)},1e3*(w-v))};o||(o=Object.assign(document.createElement("div"),{className:"sa-record "+u.className,textContent:n("record")}),o.addEventListener("click",async()=>{if(i)g();else{const e=await b();if(!e)return void t.log("Canceled");O(e)}})),u.parentElement.appendChild(o)}},"style.css":n.n(o).a}}}]);